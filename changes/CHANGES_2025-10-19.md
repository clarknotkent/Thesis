# Change Log — 2025-10-19

This document summarizes all code changes made on 2025-10-19.

## Backend

- backend/controllers/immunizationController.js
  - Fixed GET /immunizations to respect query filters: patient_id, vaccine_id, administered_by.
  - Added support for optional limit and sort (e.g., administered_date:desc).
- backend/models/immunizationModel.js
  - listImmunizations now accepts limit and sort; continues to filter by patient_id, vaccine_id, administered_by.

## Frontend

- frontend/src/views/healthworker/AddPatient.vue
  - Moved the shared <datalist id="hw-parent-names"> inside the <template> (below the form) to fix Vite import-analysis error.
- frontend/src/components/common/VisitEditor.vue
  - Health Staff fetching: Parse backend shape { success, data: { healthStaff: [...] } } in addition to prior shapes.
  - Role filtering:
    - Visit “Health Staff (BHS)” dropdown shows only Health Staff roles (BHS/Barangay Health Worker/Health Staff), normalized label.
    - Vaccination dropdown shows only Nurses/Nutritionists; normalized labels (Nurse/Nutritionist).
  - Vaccine display in added list: Prefer vaccine_name -> vaccineName -> antigen_name to avoid "Unknown Vaccine".
  - Include vaccine_name in collected vaccination payloads to keep preview consistent.
  - Fix collectedVaccinations computed to use the array prop directly (not a ref).

## Behavior changes

- New patient Vaccination History pages now remain empty until that patient has records (server honors patient_id filtering).
- Visit/Record flow shows properly filtered Health Staff and Nurses/Nutritionists lists.
- Added vaccines preview shows correct antigen/vaccine names instead of "Unknown Vaccine".
- Add Patient page builds without Vite parse errors.

## How to validate

- Frontend: restart dev server and open Visit/Record editor. Check role dropdowns and vaccine preview names.
- Backend: call GET /api/immunizations?patient_id=<id>&limit=1&sort=administered_date:desc — verify only the specified patient’s records are returned.

## Notes

- If backend still exits with code 1 on start, capture and share the error logs for a quick follow-up fix.
