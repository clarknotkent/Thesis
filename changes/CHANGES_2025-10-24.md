# Change Log — 2025-10-24 (Roll-up)

This file consolidates the notable changes completed so far on branch `system-prototype-v1`, rolling up the prior daily logs and uncommitted diffs into a single snapshot before pushing to the repo.

## Highlights

- Backend: filtering and pagination for Immunizations; Visit/Immunization controller and model updates.
- Frontend: Visit Editor role filtering and data shape handling; router tweaks; Admin Chat and Notifications Inbox polish; inventory form fixes; build fix for Add Patient.
- Quality: clearer vaccine display names and more robust payloads in Visit flows.

## Backend

- Immunizations
  - GET /immunizations now respects filters: `patient_id`, `vaccine_id`, `administered_by`.
  - Optional `limit` and `sort` (e.g., `administered_date:desc`).
  - `immunizationModel.listImmunizations` accepts `limit` and `sort` and maintains existing filters.
- Visits/Controllers/Models
  - Updates across `backend/controllers/visitController.js`, `backend/models/immunizationModel.js`, and `backend/models/visitModel.js` to support the above behavior and Visit Editor changes.

## Frontend

- Visit Editor (`frontend/src/components/common/VisitEditor.vue`)
  - Health Staff fetching: tolerant to backend response shapes `{ success, data: { healthStaff: [...] } }` as well as prior variants.
  - Role filtering:
    - "Health Staff (BHS)" dropdown shows only Health Staff roles and normalizes labels.
    - Vaccination dropdown limits to Nurses/Nutritionists and normalizes labels.
  - Vaccines display: prefer `vaccine_name` -> `vaccineName` -> `antigen_name` to avoid "Unknown Vaccine".
  - Include `vaccine_name` in collected vaccination payloads to keep preview consistent.
- Add Patient (`frontend/src/views/healthworker/AddPatient.vue`)
  - Moved shared `<datalist id="hw-parent-names">` inside `<template>` to resolve Vite import-analysis build error.
- Other UI/pages
  - Router tweaks in `frontend/src/router/index.js`.
  - Admin Chat UI improvements in `frontend/src/views/admin/chat/AdminChat.vue`.
  - Notifications Inbox received a major update in `frontend/src/views/admin/notifications/NotificationsInbox.vue`.
  - Inventory views/forms adjustments, including `VaccineInventory.vue` and `VaccineForm.vue`; added `EditVaccineType.vue`.

## Behavior changes

- New patient Vaccination History remains empty until that patient has records (server honors `patient_id` filtering).
- Visit/Record flow shows properly filtered Health Staff and Nurses/Nutritionists lists.
- Vaccines preview shows correct names instead of "Unknown Vaccine".
- Add Patient page builds without Vite parse errors.

## Validation

- Frontend: run the dev server, open Visit/Record editor and verify role dropdowns and vaccine preview names.
- Backend: call `GET /api/immunizations?patient_id=<id>&limit=1&sort=administered_date:desc` and verify only the specified patient’s records are returned and sorting/limit apply.

## Files referenced in prior logs

- See `CHANGES_2025-10-19.md` for the initial set of backend/Visit Editor fixes.
- See `CHANGES_2025-10-21_UNCOMMITTED.md` for the follow-up uncommitted diffs (Visit/Immunization updates, router tweaks, Admin Chat and Notifications overhaul, inventory adjustments).

---
Generated: 2025-10-24