-- Primary keys, unique, check, excludes and foreign keys with column mappings
WITH cons AS (
  SELECT
    n.nspname AS schema,
    c.relname AS table_name,
    con.conname AS constraint_name,
    con.contype,
    con.conkey,
    con.confkey,
    con.conrelid,
    con.confrelid,
    pg_catalog.pg_get_constraintdef(con.oid, true) AS definition
  FROM pg_constraint con
  JOIN pg_class c ON c.oid = con.conrelid
  JOIN pg_namespace n ON n.oid = c.relnamespace
  WHERE n.nspname NOT IN ('pg_catalog','information_schema')
    AND n.nspname NOT LIKE 'pg_toast%'
    AND n.nspname NOT LIKE 'pg_temp%'
    AND n.nspname = 'public' -- Limit to public schema only
), cols AS (
  SELECT attrelid, attnum, attname FROM pg_attribute WHERE attnum > 0 AND NOT attisdropped
)
SELECT
  cons.schema,
  cons.table_name,
  cons.constraint_name,
  CASE cons.contype
    WHEN 'p' THEN 'PRIMARY KEY'
    WHEN 'u' THEN 'UNIQUE'
    WHEN 'c' THEN 'CHECK'
    WHEN 'f' THEN 'FOREIGN KEY'
    WHEN 'x' THEN 'EXCLUDE'
  END AS constraint_type,
  -- list constrained columns in defined order
  string_agg(att.attname, ', ' ORDER BY ck.ord) FILTER (WHERE cons.conkey IS NOT NULL) AS columns,
  CASE WHEN cons.contype = 'f' THEN (
    SELECT n2.nspname || '.' || c2.relname
    FROM pg_class c2 JOIN pg_namespace n2 ON n2.oid = c2.relnamespace
    WHERE c2.oid = cons.confrelid
  ) END AS references_table,
  CASE WHEN cons.contype = 'f' THEN (
    SELECT string_agg(att2.attname, ', ' ORDER BY fk.ord)
    FROM unnest(cons.confkey) WITH ORDINALITY AS fk(attnum, ord)
    JOIN pg_attribute att2 ON att2.attrelid = cons.confrelid AND att2.attnum = fk.attnum
  ) END AS references_columns,
  cons.definition
FROM cons
LEFT JOIN unnest(cons.conkey) WITH ORDINALITY AS ck(attnum, ord) ON true
LEFT JOIN cols att ON att.attrelid = cons.conrelid AND att.attnum = ck.attnum
GROUP BY cons.schema, cons.table_name, cons.constraint_name, cons.contype, cons.confrelid, cons.confkey, cons.definition
ORDER BY cons.schema, cons.table_name, cons.constraint_name;

| schema | table_name                    | constraint_name                                | constraint_type | columns                                                                            | references_table         | references_columns | definition                                                                                                                                                                                                                                      |
| ------ | ----------------------------- | ---------------------------------------------- | --------------- | ---------------------------------------------------------------------------------- | ------------------------ | ------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| public | activity_action_types         | activity_action_types_pkey                     | PRIMARY KEY     | action_type                                                                        | null                     | null               | PRIMARY KEY (action_type)                                                                                                                                                                                                                       |
| public | activitylogs                  | activitylogs_pkey                              | PRIMARY KEY     | log_id                                                                             | null                     | null               | PRIMARY KEY (log_id)                                                                                                                                                                                                                            |
| public | birthhistory                  | birthhistory_created_by_fkey                   | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | birthhistory                  | birthhistory_deleted_by_fkey                   | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | birthhistory                  | birthhistory_patient_id_fkey                   | FOREIGN KEY     | patient_id                                                                         | public.patients          | patient_id         | FOREIGN KEY (patient_id) REFERENCES patients(patient_id)                                                                                                                                                                                        |
| public | birthhistory                  | birthhistory_pkey                              | PRIMARY KEY     | birthhistory_id                                                                    | null                     | null               | PRIMARY KEY (birthhistory_id)                                                                                                                                                                                                                   |
| public | birthhistory                  | birthhistory_updated_by_fkey                   | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | birthhistory                  | fk_birthhistory_patient                        | FOREIGN KEY     | patient_id                                                                         | public.patients          | patient_id         | FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE CASCADE                                                                                                                                                                      |
| public | conversationparticipants      | conversationparticipants_conversation_id_fkey  | FOREIGN KEY     | conversation_id                                                                    | public.conversations     | conversation_id    | FOREIGN KEY (conversation_id) REFERENCES conversations(conversation_id)                                                                                                                                                                         |
| public | conversationparticipants      | conversationparticipants_created_by_fkey       | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | conversationparticipants      | conversationparticipants_deleted_by_fkey       | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | conversationparticipants      | conversationparticipants_pkey                  | PRIMARY KEY     | conversation_participant_id                                                        | null                     | null               | PRIMARY KEY (conversation_participant_id)                                                                                                                                                                                                       |
| public | conversationparticipants      | conversationparticipants_updated_by_fkey       | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | conversationparticipants      | conversationparticipants_user_id_fkey          | FOREIGN KEY     | user_id                                                                            | public.users             | user_id            | FOREIGN KEY (user_id) REFERENCES users(user_id)                                                                                                                                                                                                 |
| public | conversations                 | conversations_created_by_fkey                  | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | conversations                 | conversations_deleted_by_fkey                  | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | conversations                 | conversations_pkey                             | PRIMARY KEY     | conversation_id                                                                    | null                     | null               | PRIMARY KEY (conversation_id)                                                                                                                                                                                                                   |
| public | conversations                 | conversations_updated_by_fkey                  | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | deworming                     | deworming_administered_by_fkey                 | FOREIGN KEY     | administered_by                                                                    | public.users             | user_id            | FOREIGN KEY (administered_by) REFERENCES users(user_id)                                                                                                                                                                                         |
| public | deworming                     | deworming_created_by_fkey                      | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | deworming                     | deworming_deleted_by_fkey                      | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | deworming                     | deworming_inventory_id_fkey                    | FOREIGN KEY     | inventory_id                                                                       | public.inventory         | inventory_id       | FOREIGN KEY (inventory_id) REFERENCES inventory(inventory_id)                                                                                                                                                                                   |
| public | deworming                     | deworming_outside_inside_chk                   | CHECK           | outside, patient_id, vaccine_id, visit_id, inventory_id, administered_by, vital_id | null                     | null               | CHECK (
CASE
    WHEN outside IS TRUE THEN patient_id IS NOT NULL AND vaccine_id IS NOT NULL
    ELSE visit_id IS NOT NULL AND inventory_id IS NOT NULL AND administered_by IS NOT NULL AND vital_id IS NOT NULL
END)                           |
| public | deworming                     | deworming_patient_id_fkey                      | FOREIGN KEY     | patient_id                                                                         | public.patients          | patient_id         | FOREIGN KEY (patient_id) REFERENCES patients(patient_id)                                                                                                                                                                                        |
| public | deworming                     | deworming_pkey                                 | PRIMARY KEY     | deworming_id                                                                       | null                     | null               | PRIMARY KEY (deworming_id)                                                                                                                                                                                                                      |
| public | deworming                     | deworming_updated_by_fkey                      | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | deworming                     | deworming_vaccine_id_fkey                      | FOREIGN KEY     | vaccine_id                                                                         | public.vaccinemaster     | vaccine_id         | FOREIGN KEY (vaccine_id) REFERENCES vaccinemaster(vaccine_id)                                                                                                                                                                                   |
| public | deworming                     | deworming_visit_id_fkey                        | FOREIGN KEY     | visit_id                                                                           | public.visits            | visit_id           | FOREIGN KEY (visit_id) REFERENCES visits(visit_id)                                                                                                                                                                                              |
| public | deworming                     | deworming_vital_id_fkey                        | FOREIGN KEY     | vital_id                                                                           | public.vitalsigns        | vital_id           | FOREIGN KEY (vital_id) REFERENCES vitalsigns(vital_id)                                                                                                                                                                                          |
| public | deworming_history             | deworming_history_pkey                         | PRIMARY KEY     | history_id                                                                         | null                     | null               | PRIMARY KEY (history_id)                                                                                                                                                                                                                        |
| public | faqs                          | faqs_pkey                                      | PRIMARY KEY     | faq_id                                                                             | null                     | null               | PRIMARY KEY (faq_id)                                                                                                                                                                                                                            |
| public | guardian_auto_send_settings   | guardian_auto_send_settings_created_by_fkey    | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id) ON DELETE SET NULL                                                                                                                                                                           |
| public | guardian_auto_send_settings   | guardian_auto_send_settings_deleted_by_fkey    | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id) ON DELETE SET NULL                                                                                                                                                                           |
| public | guardian_auto_send_settings   | guardian_auto_send_settings_guardian_id_fkey   | FOREIGN KEY     | guardian_id                                                                        | public.guardians         | guardian_id        | FOREIGN KEY (guardian_id) REFERENCES guardians(guardian_id) ON DELETE CASCADE                                                                                                                                                                   |
| public | guardian_auto_send_settings   | guardian_auto_send_settings_guardian_id_key    | UNIQUE          | guardian_id                                                                        | null                     | null               | UNIQUE (guardian_id)                                                                                                                                                                                                                            |
| public | guardian_auto_send_settings   | guardian_auto_send_settings_pkey               | PRIMARY KEY     | id                                                                                 | null                     | null               | PRIMARY KEY (id)                                                                                                                                                                                                                                |
| public | guardian_auto_send_settings   | guardian_auto_send_settings_updated_by_fkey    | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id) ON DELETE SET NULL                                                                                                                                                                           |
| public | guardians                     | guardians_contact_number_key                   | UNIQUE          | contact_number                                                                     | null                     | null               | UNIQUE (contact_number)                                                                                                                                                                                                                         |
| public | guardians                     | guardians_created_by_fkey                      | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | guardians                     | guardians_deleted_by_fkey                      | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | guardians                     | guardians_pkey                                 | PRIMARY KEY     | guardian_id                                                                        | null                     | null               | PRIMARY KEY (guardian_id)                                                                                                                                                                                                                       |
| public | guardians                     | guardians_updated_by_fkey                      | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | guardians                     | guardians_user_id_fkey                         | FOREIGN KEY     | user_id                                                                            | public.users             | user_id            | FOREIGN KEY (user_id) REFERENCES users(user_id)                                                                                                                                                                                                 |
| public | health_staff_types            | health_staff_types_pkey                        | PRIMARY KEY     | code                                                                               | null                     | null               | PRIMARY KEY (code)                                                                                                                                                                                                                              |
| public | immunizations                 | immunizations_administered_by_fkey             | FOREIGN KEY     | administered_by                                                                    | public.users             | user_id            | FOREIGN KEY (administered_by) REFERENCES users(user_id)                                                                                                                                                                                         |
| public | immunizations                 | immunizations_created_by_fkey                  | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | immunizations                 | immunizations_deleted_by_fkey                  | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | immunizations                 | immunizations_inventory_id_fkey                | FOREIGN KEY     | inventory_id                                                                       | public.inventory         | inventory_id       | FOREIGN KEY (inventory_id) REFERENCES inventory(inventory_id)                                                                                                                                                                                   |
| public | immunizations                 | immunizations_outside_inside_chk               | CHECK           | outside, patient_id, vaccine_id, visit_id, inventory_id, administered_by, vital_id | null                     | null               | CHECK (
CASE
    WHEN outside IS TRUE THEN patient_id IS NOT NULL AND vaccine_id IS NOT NULL
    ELSE visit_id IS NOT NULL AND inventory_id IS NOT NULL AND administered_by IS NOT NULL AND vital_id IS NOT NULL
END)                           |
| public | immunizations                 | immunizations_outside_inventory_chk            | CHECK           | outside, inventory_id                                                              | null                     | null               | CHECK (NOT outside OR inventory_id IS NULL)                                                                                                                                                                                                     |
| public | immunizations                 | immunizations_patient_id_fkey                  | FOREIGN KEY     | patient_id                                                                         | public.patients          | patient_id         | FOREIGN KEY (patient_id) REFERENCES patients(patient_id)                                                                                                                                                                                        |
| public | immunizations                 | immunizations_pkey                             | PRIMARY KEY     | immunization_id                                                                    | null                     | null               | PRIMARY KEY (immunization_id)                                                                                                                                                                                                                   |
| public | immunizations                 | immunizations_updated_by_fkey                  | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | immunizations                 | immunizations_vaccine_id_fkey                  | FOREIGN KEY     | vaccine_id                                                                         | public.vaccinemaster     | vaccine_id         | FOREIGN KEY (vaccine_id) REFERENCES vaccinemaster(vaccine_id)                                                                                                                                                                                   |
| public | immunizations                 | immunizations_visit_id_fkey                    | FOREIGN KEY     | visit_id                                                                           | public.visits            | visit_id           | FOREIGN KEY (visit_id) REFERENCES visits(visit_id)                                                                                                                                                                                              |
| public | immunizations                 | immunizations_visit_or_patient_chk             | CHECK           | visit_id, patient_id                                                               | null                     | null               | CHECK (visit_id IS NOT NULL OR patient_id IS NOT NULL)                                                                                                                                                                                          |
| public | immunizations                 | immunizations_vital_id_fkey                    | FOREIGN KEY     | vital_id                                                                           | public.vitalsigns        | vital_id           | FOREIGN KEY (vital_id) REFERENCES vitalsigns(vital_id)                                                                                                                                                                                          |
| public | immunizations_history         | immunizations_history_pkey                     | PRIMARY KEY     | history_id                                                                         | null                     | null               | PRIMARY KEY (history_id)                                                                                                                                                                                                                        |
| public | inventory                     | chk_inventory_initial_qty_nonneg               | CHECK           | initial_quantity                                                                   | null                     | null               | CHECK (initial_quantity IS NULL OR initial_quantity >= 0)                                                                                                                                                                                       |
| public | inventory                     | chk_inventory_stock_nonneg                     | CHECK           | current_stock_level                                                                | null                     | null               | CHECK (current_stock_level >= 0)                                                                                                                                                                                                                |
| public | inventory                     | inventory_created_by_fkey                      | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | inventory                     | inventory_current_stock_nonnegative            | CHECK           | current_stock_level                                                                | null                     | null               | CHECK (current_stock_level >= 0)                                                                                                                                                                                                                |
| public | inventory                     | inventory_deleted_by_fkey                      | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | inventory                     | inventory_pkey                                 | PRIMARY KEY     | inventory_id                                                                       | null                     | null               | PRIMARY KEY (inventory_id)                                                                                                                                                                                                                      |
| public | inventory                     | inventory_updated_by_fkey                      | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | inventory                     | inventory_vaccine_id_fkey                      | FOREIGN KEY     | vaccine_id                                                                         | public.vaccinemaster     | vaccine_id         | FOREIGN KEY (vaccine_id) REFERENCES vaccinemaster(vaccine_id)                                                                                                                                                                                   |
| public | inventory_history             | inventory_history_pkey                         | PRIMARY KEY     | history_id                                                                         | null                     | null               | PRIMARY KEY (history_id)                                                                                                                                                                                                                        |
| public | inventory_requests            | chk_inventory_requests_approval                | CHECK           | status, approved_at, approved_by                                                   | null                     | null               | CHECK (status::text = 'approved'::text AND approved_at IS NOT NULL AND approved_by IS NOT NULL OR status::text <> 'approved'::text)                                                                                                             |
| public | inventory_requests            | chk_inventory_requests_rejected                | CHECK           | status, remarks                                                                    | null                     | null               | CHECK (status::text <> 'rejected'::text OR status::text = 'rejected'::text AND remarks IS NOT NULL AND length(TRIM(BOTH FROM remarks)) > 0)                                                                                                     |
| public | inventory_requests            | inventory_requests_approved_by_fkey            | FOREIGN KEY     | approved_by                                                                        | public.users             | user_id            | FOREIGN KEY (approved_by) REFERENCES users(user_id)                                                                                                                                                                                             |
| public | inventory_requests            | inventory_requests_created_by_fkey             | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | inventory_requests            | inventory_requests_deleted_by_fkey             | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | inventory_requests            | inventory_requests_inventory_id_fkey           | FOREIGN KEY     | inventory_id                                                                       | public.inventory         | inventory_id       | FOREIGN KEY (inventory_id) REFERENCES inventory(inventory_id)                                                                                                                                                                                   |
| public | inventory_requests            | inventory_requests_pkey                        | PRIMARY KEY     | request_id                                                                         | null                     | null               | PRIMARY KEY (request_id)                                                                                                                                                                                                                        |
| public | inventory_requests            | inventory_requests_request_type_check          | CHECK           | request_type                                                                       | null                     | null               | CHECK (request_type::text = ANY (ARRAY['Restock'::character varying, 'Return'::character varying]::text[]))                                                                                                                                     |
| public | inventory_requests            | inventory_requests_requested_by_fkey           | FOREIGN KEY     | requested_by                                                                       | public.users             | user_id            | FOREIGN KEY (requested_by) REFERENCES users(user_id)                                                                                                                                                                                            |
| public | inventory_requests            | inventory_requests_status_check                | CHECK           | status                                                                             | null                     | null               | CHECK (status::text = ANY (ARRAY['Pending'::character varying, 'Approved'::character varying, 'Rejected'::character varying]::text[]))                                                                                                          |
| public | inventory_requests            | inventory_requests_updated_by_fkey             | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | inventory_requests_history    | inventory_requests_history_pkey                | PRIMARY KEY     | history_id                                                                         | null                     | null               | PRIMARY KEY (history_id)                                                                                                                                                                                                                        |
| public | inventorytransactions         | inventorytransactions_created_by_fkey          | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | inventorytransactions         | inventorytransactions_deleted_by_fkey          | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | inventorytransactions         | inventorytransactions_inventory_id_fkey        | FOREIGN KEY     | inventory_id                                                                       | public.inventory         | inventory_id       | FOREIGN KEY (inventory_id) REFERENCES inventory(inventory_id)                                                                                                                                                                                   |
| public | inventorytransactions         | inventorytransactions_performed_by_fkey        | FOREIGN KEY     | performed_by                                                                       | public.users             | user_id            | FOREIGN KEY (performed_by) REFERENCES users(user_id)                                                                                                                                                                                            |
| public | inventorytransactions         | inventorytransactions_pkey                     | PRIMARY KEY     | transaction_id                                                                     | null                     | null               | PRIMARY KEY (transaction_id)                                                                                                                                                                                                                    |
| public | inventorytransactions         | inventorytransactions_updated_by_fkey          | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | inventorytransactions_history | inventorytransactions_history_pkey             | PRIMARY KEY     | history_id                                                                         | null                     | null               | PRIMARY KEY (history_id)                                                                                                                                                                                                                        |
| public | message_receipts              | message_receipts_message_id_fkey               | FOREIGN KEY     | message_id                                                                         | public.messages          | message_id         | FOREIGN KEY (message_id) REFERENCES messages(message_id) ON DELETE CASCADE                                                                                                                                                                      |
| public | message_receipts              | message_receipts_message_id_user_id_key        | UNIQUE          | message_id, user_id                                                                | null                     | null               | UNIQUE (message_id, user_id)                                                                                                                                                                                                                    |
| public | message_receipts              | message_receipts_pkey                          | PRIMARY KEY     | receipt_id                                                                         | null                     | null               | PRIMARY KEY (receipt_id)                                                                                                                                                                                                                        |
| public | messages                      | messages_conversation_id_fkey                  | FOREIGN KEY     | conversation_id                                                                    | public.conversations     | conversation_id    | FOREIGN KEY (conversation_id) REFERENCES conversations(conversation_id)                                                                                                                                                                         |
| public | messages                      | messages_created_by_fkey                       | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | messages                      | messages_deleted_by_fkey                       | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | messages                      | messages_message_type_check                    | CHECK           | message_type                                                                       | null                     | null               | CHECK (message_type::text = ANY (ARRAY['chat'::character varying::text, 'system'::character varying::text]))                                                                                                                                    |
| public | messages                      | messages_pkey                                  | PRIMARY KEY     | message_id                                                                         | null                     | null               | PRIMARY KEY (message_id)                                                                                                                                                                                                                        |
| public | messages                      | messages_sender_id_fkey                        | FOREIGN KEY     | sender_id                                                                          | public.users             | user_id            | FOREIGN KEY (sender_id) REFERENCES users(user_id)                                                                                                                                                                                               |
| public | messages                      | messages_updated_by_fkey                       | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | notifications                 | notifications_channel_check                    | CHECK           | channel                                                                            | null                     | null               | CHECK (channel::text = ANY (ARRAY['Push'::character varying, 'SMS'::character varying, 'Email'::character varying]::text[]))                                                                                                                    |
| public | notifications                 | notifications_created_by_fkey                  | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | notifications                 | notifications_deleted_by_fkey                  | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | notifications                 | notifications_pkey                             | PRIMARY KEY     | notification_id                                                                    | null                     | null               | PRIMARY KEY (notification_id)                                                                                                                                                                                                                   |
| public | notifications                 | notifications_recipient_user_id_fkey           | FOREIGN KEY     | recipient_user_id                                                                  | public.users             | user_id            | FOREIGN KEY (recipient_user_id) REFERENCES users(user_id)                                                                                                                                                                                       |
| public | notifications                 | notifications_status_check                     | CHECK           | status                                                                             | null                     | null               | CHECK (status::text = ANY (ARRAY['Queued'::character varying, 'Sent'::character varying, 'Failed'::character varying, 'Delivered'::character varying]::text[]))                                                                                 |
| public | notifications                 | notifications_updated_by_fkey                  | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | patients                      | patients_created_by_fkey                       | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | patients                      | patients_deleted_by_fkey                       | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | patients                      | patients_guardian_id_fkey                      | FOREIGN KEY     | guardian_id                                                                        | public.guardians         | guardian_id        | FOREIGN KEY (guardian_id) REFERENCES guardians(guardian_id)                                                                                                                                                                                     |
| public | patients                      | patients_pkey                                  | PRIMARY KEY     | patient_id                                                                         | null                     | null               | PRIMARY KEY (patient_id)                                                                                                                                                                                                                        |
| public | patients                      | patients_sex_check                             | CHECK           | sex                                                                                | null                     | null               | CHECK (sex::text = ANY (ARRAY['Male'::character varying, 'Female'::character varying, 'Other'::character varying]::text[]))                                                                                                                     |
| public | patients                      | patients_tags_check                            | CHECK           | tags                                                                               | null                     | null               | CHECK (tags::text = ANY (ARRAY['None'::character varying, 'Defaulter'::character varying, 'FIC'::character varying, 'CIC'::character varying]::text[]))                                                                                         |
| public | patients                      | patients_updated_by_fkey                       | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | patients_history              | patients_history_pkey                          | PRIMARY KEY     | history_id                                                                         | null                     | null               | PRIMARY KEY (history_id)                                                                                                                                                                                                                        |
| public | patientschedule               | patientschedule_created_by_fkey                | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | patientschedule               | patientschedule_deleted_by_fkey                | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | patientschedule               | patientschedule_patient_id_fkey                | FOREIGN KEY     | patient_id                                                                         | public.patients          | patient_id         | FOREIGN KEY (patient_id) REFERENCES patients(patient_id)                                                                                                                                                                                        |
| public | patientschedule               | patientschedule_pkey                           | PRIMARY KEY     | patient_schedule_id                                                                | null                     | null               | PRIMARY KEY (patient_schedule_id)                                                                                                                                                                                                               |
| public | patientschedule               | patientschedule_status_check                   | CHECK           | status                                                                             | null                     | null               | CHECK (status::text = ANY (ARRAY['Scheduled'::text, 'Due'::text, 'Overdue'::text, 'Pending'::text, 'Completed'::text, 'Missed'::text, 'Rescheduled'::text]))                                                                                    |
| public | patientschedule               | patientschedule_updated_by_fkey                | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | patientschedule               | patientschedule_vaccine_id_fkey                | FOREIGN KEY     | vaccine_id                                                                         | public.vaccinemaster     | vaccine_id         | FOREIGN KEY (vaccine_id) REFERENCES vaccinemaster(vaccine_id)                                                                                                                                                                                   |
| public | patientschedule               | uq_patientschedule_patient_vax_dose            | UNIQUE          | patient_id, vaccine_id, dose_number                                                | null                     | null               | UNIQUE (patient_id, vaccine_id, dose_number)                                                                                                                                                                                                    |
| public | patientschedule               | uq_patientschedule_unique                      | UNIQUE          | patient_id, vaccine_id, dose_number                                                | null                     | null               | UNIQUE (patient_id, vaccine_id, dose_number)                                                                                                                                                                                                    |
| public | patientschedule_history       | patientschedule_history_pkey                   | PRIMARY KEY     | history_id                                                                         | null                     | null               | PRIMARY KEY (history_id)                                                                                                                                                                                                                        |
| public | receiving_report_items        | receiving_report_items_deleted_by_fkey         | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | receiving_report_items        | receiving_report_items_inventory_id_fkey       | FOREIGN KEY     | inventory_id                                                                       | public.inventory         | inventory_id       | FOREIGN KEY (inventory_id) REFERENCES inventory(inventory_id)                                                                                                                                                                                   |
| public | receiving_report_items        | receiving_report_items_pkey                    | PRIMARY KEY     | item_id                                                                            | null                     | null               | PRIMARY KEY (item_id)                                                                                                                                                                                                                           |
| public | receiving_report_items        | receiving_report_items_quantity_received_check | CHECK           | quantity_received                                                                  | null                     | null               | CHECK (quantity_received > 0)                                                                                                                                                                                                                   |
| public | receiving_report_items        | receiving_report_items_report_id_fkey          | FOREIGN KEY     | report_id                                                                          | public.receiving_reports | report_id          | FOREIGN KEY (report_id) REFERENCES receiving_reports(report_id)                                                                                                                                                                                 |
| public | receiving_report_items        | receiving_report_items_vaccine_id_fkey         | FOREIGN KEY     | vaccine_id                                                                         | public.vaccinemaster     | vaccine_id         | FOREIGN KEY (vaccine_id) REFERENCES vaccinemaster(vaccine_id)                                                                                                                                                                                   |
| public | receiving_reports             | receiving_reports_created_by_fkey              | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | receiving_reports             | receiving_reports_deleted_by_fkey              | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | receiving_reports             | receiving_reports_pkey                         | PRIMARY KEY     | report_id                                                                          | null                     | null               | PRIMARY KEY (report_id)                                                                                                                                                                                                                         |
| public | receiving_reports             | receiving_reports_received_by_fkey             | FOREIGN KEY     | received_by                                                                        | public.users             | user_id            | FOREIGN KEY (received_by) REFERENCES users(user_id)                                                                                                                                                                                             |
| public | receiving_reports             | receiving_reports_report_number_key            | UNIQUE          | report_number                                                                      | null                     | null               | UNIQUE (report_number)                                                                                                                                                                                                                          |
| public | receiving_reports             | receiving_reports_status_check                 | CHECK           | status                                                                             | null                     | null               | CHECK (status::text = ANY (ARRAY['DRAFT'::character varying, 'RECEIVED'::character varying, 'COMPLETED'::character varying, 'CANCELLED'::character varying]::text[]))                                                                           |
| public | receiving_reports             | receiving_reports_updated_by_fkey              | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | schedule_doses                | chk_schedule_doses_positive_intervals          | CHECK           | due_after_days, min_interval_days, max_interval_days, min_interval_other_vax       | null                     | null               | CHECK ((due_after_days IS NULL OR due_after_days >= 0) AND (min_interval_days IS NULL OR min_interval_days >= 0) AND (max_interval_days IS NULL OR max_interval_days >= 0) AND (min_interval_other_vax IS NULL OR min_interval_other_vax >= 0)) |
| public | schedule_doses                | schedule_doses_created_by_fkey                 | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | schedule_doses                | schedule_doses_deleted_by_fkey                 | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | schedule_doses                | schedule_doses_dose_number_check               | CHECK           | dose_number                                                                        | null                     | null               | CHECK (dose_number > 0)                                                                                                                                                                                                                         |
| public | schedule_doses                | schedule_doses_due_after_days_check            | CHECK           | due_after_days                                                                     | null                     | null               | CHECK (due_after_days >= 0)                                                                                                                                                                                                                     |
| public | schedule_doses                | schedule_doses_max_interval_days_check         | CHECK           | max_interval_days                                                                  | null                     | null               | CHECK (max_interval_days >= 0)                                                                                                                                                                                                                  |
| public | schedule_doses                | schedule_doses_min_interval_days_check         | CHECK           | min_interval_days                                                                  | null                     | null               | CHECK (min_interval_days >= 0)                                                                                                                                                                                                                  |
| public | schedule_doses                | schedule_doses_min_interval_other_vax_check    | CHECK           | min_interval_other_vax                                                             | null                     | null               | CHECK (min_interval_other_vax >= 0)                                                                                                                                                                                                             |
| public | schedule_doses                | schedule_doses_pkey                            | PRIMARY KEY     | id                                                                                 | null                     | null               | PRIMARY KEY (id)                                                                                                                                                                                                                                |
| public | schedule_doses                | schedule_doses_schedule_id_dose_number_key     | UNIQUE          | schedule_id, dose_number                                                           | null                     | null               | UNIQUE (schedule_id, dose_number)                                                                                                                                                                                                               |
| public | schedule_doses                | schedule_doses_schedule_id_fkey                | FOREIGN KEY     | schedule_id                                                                        | public.schedule_master   | id                 | FOREIGN KEY (schedule_id) REFERENCES schedule_master(id) ON DELETE CASCADE                                                                                                                                                                      |
| public | schedule_doses                | schedule_doses_updated_by_fkey                 | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | schedule_doses                | uq_schedule_doses_schedule_dose                | UNIQUE          | schedule_id, dose_number                                                           | null                     | null               | UNIQUE (schedule_id, dose_number)                                                                                                                                                                                                               |
| public | schedule_master               | schedule_master_created_by_fkey                | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | schedule_master               | schedule_master_deleted_by_fkey                | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | schedule_master               | schedule_master_pkey                           | PRIMARY KEY     | id                                                                                 | null                     | null               | PRIMARY KEY (id)                                                                                                                                                                                                                                |
| public | schedule_master               | schedule_master_total_doses_check              | CHECK           | total_doses                                                                        | null                     | null               | CHECK (total_doses > 0)                                                                                                                                                                                                                         |
| public | schedule_master               | schedule_master_updated_by_fkey                | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | schedule_master               | schedule_master_vaccine_id_fkey                | FOREIGN KEY     | vaccine_id                                                                         | public.vaccinemaster     | vaccine_id         | FOREIGN KEY (vaccine_id) REFERENCES vaccinemaster(vaccine_id)                                                                                                                                                                                   |
| public | schedule_master               | unique_vaccine_schedule                        | UNIQUE          | vaccine_id                                                                         | null                     | null               | UNIQUE (vaccine_id)                                                                                                                                                                                                                             |
| public | schedule_master               | uq_schedule_master_vaccine                     | UNIQUE          | vaccine_id                                                                         | null                     | null               | UNIQUE (vaccine_id)                                                                                                                                                                                                                             |
| public | sms_logs                      | sms_logs_created_by_fkey                       | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id) ON DELETE SET NULL                                                                                                                                                                           |
| public | sms_logs                      | sms_logs_deleted_by_fkey                       | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id) ON DELETE SET NULL                                                                                                                                                                           |
| public | sms_logs                      | sms_logs_guardian_id_fkey                      | FOREIGN KEY     | guardian_id                                                                        | public.guardians         | guardian_id        | FOREIGN KEY (guardian_id) REFERENCES guardians(guardian_id) ON DELETE SET NULL                                                                                                                                                                  |
| public | sms_logs                      | sms_logs_patient_id_fkey                       | FOREIGN KEY     | patient_id                                                                         | public.patients          | patient_id         | FOREIGN KEY (patient_id) REFERENCES patients(patient_id) ON DELETE SET NULL                                                                                                                                                                     |
| public | sms_logs                      | sms_logs_pkey                                  | PRIMARY KEY     | id                                                                                 | null                     | null               | PRIMARY KEY (id)                                                                                                                                                                                                                                |
| public | sms_logs                      | sms_logs_template_id_fkey                      | FOREIGN KEY     | template_id                                                                        | public.sms_templates     | id                 | FOREIGN KEY (template_id) REFERENCES sms_templates(id) ON DELETE SET NULL                                                                                                                                                                       |
| public | sms_logs                      | sms_logs_updated_by_fkey                       | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id) ON DELETE SET NULL                                                                                                                                                                           |
| public | sms_templates                 | sms_templates_created_by_fkey                  | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id) ON DELETE SET NULL                                                                                                                                                                           |
| public | sms_templates                 | sms_templates_deleted_by_fkey                  | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id) ON DELETE SET NULL                                                                                                                                                                           |
| public | sms_templates                 | sms_templates_pkey                             | PRIMARY KEY     | id                                                                                 | null                     | null               | PRIMARY KEY (id)                                                                                                                                                                                                                                |
| public | sms_templates                 | sms_templates_updated_by_fkey                  | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id) ON DELETE SET NULL                                                                                                                                                                           |
| public | timestamp_normalization_audit | timestamp_normalization_audit_pkey             | PRIMARY KEY     | table_name                                                                         | null                     | null               | PRIMARY KEY (table_name)                                                                                                                                                                                                                        |
| public | user_mapping                  | fk_user_id                                     | FOREIGN KEY     | user_id                                                                            | public.users             | user_id            | FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE                                                                                                                                                                               |
| public | user_mapping                  | user_mapping_pkey                              | PRIMARY KEY     | uuid                                                                               | null                     | null               | PRIMARY KEY (uuid)                                                                                                                                                                                                                              |
| public | user_mapping                  | user_mapping_user_id_key                       | UNIQUE          | user_id                                                                            | null                     | null               | UNIQUE (user_id)                                                                                                                                                                                                                                |
| public | user_sessions                 | user_sessions_pkey                             | PRIMARY KEY     | user_id                                                                            | null                     | null               | PRIMARY KEY (user_id)                                                                                                                                                                                                                           |
| public | user_sessions                 | user_sessions_user_id_fkey                     | FOREIGN KEY     | user_id                                                                            | public.users             | user_id            | FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE                                                                                                                                                                               |
| public | users                         | users_contact_number_key                       | UNIQUE          | contact_number                                                                     | null                     | null               | UNIQUE (contact_number)                                                                                                                                                                                                                         |
| public | users                         | users_created_by_fkey                          | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | users                         | users_deleted_by_fkey                          | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | users                         | users_email_key                                | UNIQUE          | email                                                                              | null                     | null               | UNIQUE (email)                                                                                                                                                                                                                                  |
| public | users                         | users_hs_type_check                            | CHECK           | hs_type                                                                            | null                     | null               | CHECK (hs_type IS NULL OR (hs_type = ANY (ARRAY['nurse'::text, 'nutritionist'::text, 'bhs'::text])))                                                                                                                                            |
| public | users                         | users_pkey                                     | PRIMARY KEY     | user_id                                                                            | null                     | null               | PRIMARY KEY (user_id)                                                                                                                                                                                                                           |
| public | users                         | users_role_check                               | CHECK           | role                                                                               | null                     | null               | CHECK (role::text = ANY (ARRAY['Admin'::character varying::text, 'HealthStaff'::character varying::text, 'Nurse'::character varying::text, 'Nutritionist'::character varying::text, 'Guardian'::character varying::text]))                      |
| public | users                         | users_sex_check                                | CHECK           | sex                                                                                | null                     | null               | CHECK (sex::text = ANY (ARRAY['Male'::character varying, 'Female'::character varying, 'Other'::character varying]::text[]))                                                                                                                     |
| public | users                         | users_updated_by_fkey                          | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | users                         | users_username_key                             | UNIQUE          | username                                                                           | null                     | null               | UNIQUE (username)                                                                                                                                                                                                                               |
| public | users_history                 | users_history_pkey                             | PRIMARY KEY     | history_id                                                                         | null                     | null               | PRIMARY KEY (history_id)                                                                                                                                                                                                                        |
| public | vaccinemaster                 | vaccinemaster_created_by_fkey                  | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | vaccinemaster                 | vaccinemaster_deleted_by_fkey                  | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | vaccinemaster                 | vaccinemaster_pkey                             | PRIMARY KEY     | vaccine_id                                                                         | null                     | null               | PRIMARY KEY (vaccine_id)                                                                                                                                                                                                                        |
| public | vaccinemaster                 | vaccinemaster_updated_by_fkey                  | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | vaccinemaster                 | vaccinemaster_vaccine_type_check               | CHECK           | vaccine_type                                                                       | null                     | null               | CHECK (vaccine_type::text = ANY (ARRAY['inactivated'::character varying, 'live'::character varying]::text[]))                                                                                                                                   |
| public | visits                        | visits_created_by_fkey                         | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | visits                        | visits_deleted_by_fkey                         | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | visits                        | visits_patient_id_fkey                         | FOREIGN KEY     | patient_id                                                                         | public.patients          | patient_id         | FOREIGN KEY (patient_id) REFERENCES patients(patient_id)                                                                                                                                                                                        |
| public | visits                        | visits_pkey                                    | PRIMARY KEY     | visit_id                                                                           | null                     | null               | PRIMARY KEY (visit_id)                                                                                                                                                                                                                          |
| public | visits                        | visits_recorded_by_fkey                        | FOREIGN KEY     | recorded_by                                                                        | public.users             | user_id            | FOREIGN KEY (recorded_by) REFERENCES users(user_id)                                                                                                                                                                                             |
| public | visits                        | visits_updated_by_fkey                         | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | visits_history                | visits_history_pkey                            | PRIMARY KEY     | history_id                                                                         | null                     | null               | PRIMARY KEY (history_id)                                                                                                                                                                                                                        |
| public | vitalsigns                    | vitalsigns_created_by_fkey                     | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | vitalsigns                    | vitalsigns_deleted_by_fkey                     | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | vitalsigns                    | vitalsigns_pkey                                | PRIMARY KEY     | vital_id                                                                           | null                     | null               | PRIMARY KEY (vital_id)                                                                                                                                                                                                                          |
| public | vitalsigns                    | vitalsigns_updated_by_fkey                     | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | vitalsigns                    | vitalsigns_visit_id_fkey                       | FOREIGN KEY     | visit_id                                                                           | public.visits            | visit_id           | FOREIGN KEY (visit_id) REFERENCES visits(visit_id)                                                                                                                                                                                              |
| public | vitamina                      | vitamina_administered_by_fkey                  | FOREIGN KEY     | administered_by                                                                    | public.users             | user_id            | FOREIGN KEY (administered_by) REFERENCES users(user_id)                                                                                                                                                                                         |
| public | vitamina                      | vitamina_created_by_fkey                       | FOREIGN KEY     | created_by                                                                         | public.users             | user_id            | FOREIGN KEY (created_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | vitamina                      | vitamina_deleted_by_fkey                       | FOREIGN KEY     | deleted_by                                                                         | public.users             | user_id            | FOREIGN KEY (deleted_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | vitamina                      | vitamina_inventory_id_fkey                     | FOREIGN KEY     | inventory_id                                                                       | public.inventory         | inventory_id       | FOREIGN KEY (inventory_id) REFERENCES inventory(inventory_id)                                                                                                                                                                                   |
| public | vitamina                      | vitamina_outside_inside_chk                    | CHECK           | outside, patient_id, vaccine_id, visit_id, inventory_id, administered_by, vital_id | null                     | null               | CHECK (
CASE
    WHEN outside IS TRUE THEN patient_id IS NOT NULL AND vaccine_id IS NOT NULL
    ELSE visit_id IS NOT NULL AND inventory_id IS NOT NULL AND administered_by IS NOT NULL AND vital_id IS NOT NULL
END)                           |
| public | vitamina                      | vitamina_patient_id_fkey                       | FOREIGN KEY     | patient_id                                                                         | public.patients          | patient_id         | FOREIGN KEY (patient_id) REFERENCES patients(patient_id)                                                                                                                                                                                        |
| public | vitamina                      | vitamina_pkey                                  | PRIMARY KEY     | vitamina_id                                                                        | null                     | null               | PRIMARY KEY (vitamina_id)                                                                                                                                                                                                                       |
| public | vitamina                      | vitamina_updated_by_fkey                       | FOREIGN KEY     | updated_by                                                                         | public.users             | user_id            | FOREIGN KEY (updated_by) REFERENCES users(user_id)                                                                                                                                                                                              |
| public | vitamina                      | vitamina_vaccine_id_fkey                       | FOREIGN KEY     | vaccine_id                                                                         | public.vaccinemaster     | vaccine_id         | FOREIGN KEY (vaccine_id) REFERENCES vaccinemaster(vaccine_id)                                                                                                                                                                                   |
| public | vitamina                      | vitamina_visit_id_fkey                         | FOREIGN KEY     | visit_id                                                                           | public.visits            | visit_id           | FOREIGN KEY (visit_id) REFERENCES visits(visit_id)                                                                                                                                                                                              |
| public | vitamina                      | vitamina_vital_id_fkey                         | FOREIGN KEY     | vital_id                                                                           | public.vitalsigns        | vital_id           | FOREIGN KEY (vital_id) REFERENCES vitalsigns(vital_id)                                                                                                                                                                                          |
| public | vitamina_history              | vitamina_history_pkey                          | PRIMARY KEY     | history_id                                                                         | null                     | null               | PRIMARY KEY (history_id)                                                                                                                                                                                                                        |