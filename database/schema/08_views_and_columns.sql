-- Views and their columns with view definitions
WITH views AS (
  SELECT table_schema AS schema, table_name AS view_name
  FROM information_schema.views
  WHERE table_schema NOT IN ('pg_catalog','information_schema')
    AND table_schema NOT LIKE 'pg_toast%'
    AND table_schema NOT LIKE 'pg_temp%'
    AND table_schema = 'public' -- Limit to public schema only
)
SELECT
  v.schema,
  v.view_name,
  c.ordinal_position AS column_position,
  c.column_name,
  c.data_type,
  pg_get_viewdef(format('%I.%I', v.schema, v.view_name)::regclass, true) AS view_definition
FROM views v
JOIN information_schema.columns c
  ON c.table_schema = v.schema AND c.table_name = v.view_name
ORDER BY v.schema, v.view_name, c.ordinal_position;

| schema | view_name                | column_position | column_name                          | data_type                   | view_definition                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ------ | ------------------------ | --------------- | ------------------------------------ | --------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| public | activitylogs_view        | 1               | log_id                               | bigint                      |  SELECT a.log_id,
    a.user_id,
    a.action_type,
    a.entity_type,
    a.entity_id,
    a.description,
    a.old_value,
    a.new_value,
    timezone('Asia/Manila'::text, a."timestamp"::timestamp with time zone) AS "timestamp",
    COALESCE(u.full_name, 'System'::text) AS user_fullname,
    u.username,
    u.role AS user_role
   FROM activitylogs a
     LEFT JOIN users u ON u.user_id = a.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | activitylogs_view        | 2               | user_id                              | bigint                      |  SELECT a.log_id,
    a.user_id,
    a.action_type,
    a.entity_type,
    a.entity_id,
    a.description,
    a.old_value,
    a.new_value,
    timezone('Asia/Manila'::text, a."timestamp"::timestamp with time zone) AS "timestamp",
    COALESCE(u.full_name, 'System'::text) AS user_fullname,
    u.username,
    u.role AS user_role
   FROM activitylogs a
     LEFT JOIN users u ON u.user_id = a.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | activitylogs_view        | 3               | action_type                          | character varying           |  SELECT a.log_id,
    a.user_id,
    a.action_type,
    a.entity_type,
    a.entity_id,
    a.description,
    a.old_value,
    a.new_value,
    timezone('Asia/Manila'::text, a."timestamp"::timestamp with time zone) AS "timestamp",
    COALESCE(u.full_name, 'System'::text) AS user_fullname,
    u.username,
    u.role AS user_role
   FROM activitylogs a
     LEFT JOIN users u ON u.user_id = a.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | activitylogs_view        | 4               | entity_type                          | character varying           |  SELECT a.log_id,
    a.user_id,
    a.action_type,
    a.entity_type,
    a.entity_id,
    a.description,
    a.old_value,
    a.new_value,
    timezone('Asia/Manila'::text, a."timestamp"::timestamp with time zone) AS "timestamp",
    COALESCE(u.full_name, 'System'::text) AS user_fullname,
    u.username,
    u.role AS user_role
   FROM activitylogs a
     LEFT JOIN users u ON u.user_id = a.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | activitylogs_view        | 5               | entity_id                            | bigint                      |  SELECT a.log_id,
    a.user_id,
    a.action_type,
    a.entity_type,
    a.entity_id,
    a.description,
    a.old_value,
    a.new_value,
    timezone('Asia/Manila'::text, a."timestamp"::timestamp with time zone) AS "timestamp",
    COALESCE(u.full_name, 'System'::text) AS user_fullname,
    u.username,
    u.role AS user_role
   FROM activitylogs a
     LEFT JOIN users u ON u.user_id = a.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | activitylogs_view        | 6               | description                          | text                        |  SELECT a.log_id,
    a.user_id,
    a.action_type,
    a.entity_type,
    a.entity_id,
    a.description,
    a.old_value,
    a.new_value,
    timezone('Asia/Manila'::text, a."timestamp"::timestamp with time zone) AS "timestamp",
    COALESCE(u.full_name, 'System'::text) AS user_fullname,
    u.username,
    u.role AS user_role
   FROM activitylogs a
     LEFT JOIN users u ON u.user_id = a.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | activitylogs_view        | 7               | old_value                            | jsonb                       |  SELECT a.log_id,
    a.user_id,
    a.action_type,
    a.entity_type,
    a.entity_id,
    a.description,
    a.old_value,
    a.new_value,
    timezone('Asia/Manila'::text, a."timestamp"::timestamp with time zone) AS "timestamp",
    COALESCE(u.full_name, 'System'::text) AS user_fullname,
    u.username,
    u.role AS user_role
   FROM activitylogs a
     LEFT JOIN users u ON u.user_id = a.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | activitylogs_view        | 8               | new_value                            | jsonb                       |  SELECT a.log_id,
    a.user_id,
    a.action_type,
    a.entity_type,
    a.entity_id,
    a.description,
    a.old_value,
    a.new_value,
    timezone('Asia/Manila'::text, a."timestamp"::timestamp with time zone) AS "timestamp",
    COALESCE(u.full_name, 'System'::text) AS user_fullname,
    u.username,
    u.role AS user_role
   FROM activitylogs a
     LEFT JOIN users u ON u.user_id = a.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | activitylogs_view        | 9               | timestamp                            | timestamp without time zone |  SELECT a.log_id,
    a.user_id,
    a.action_type,
    a.entity_type,
    a.entity_id,
    a.description,
    a.old_value,
    a.new_value,
    timezone('Asia/Manila'::text, a."timestamp"::timestamp with time zone) AS "timestamp",
    COALESCE(u.full_name, 'System'::text) AS user_fullname,
    u.username,
    u.role AS user_role
   FROM activitylogs a
     LEFT JOIN users u ON u.user_id = a.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | activitylogs_view        | 10              | user_fullname                        | text                        |  SELECT a.log_id,
    a.user_id,
    a.action_type,
    a.entity_type,
    a.entity_id,
    a.description,
    a.old_value,
    a.new_value,
    timezone('Asia/Manila'::text, a."timestamp"::timestamp with time zone) AS "timestamp",
    COALESCE(u.full_name, 'System'::text) AS user_fullname,
    u.username,
    u.role AS user_role
   FROM activitylogs a
     LEFT JOIN users u ON u.user_id = a.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | activitylogs_view        | 11              | username                             | character varying           |  SELECT a.log_id,
    a.user_id,
    a.action_type,
    a.entity_type,
    a.entity_id,
    a.description,
    a.old_value,
    a.new_value,
    timezone('Asia/Manila'::text, a."timestamp"::timestamp with time zone) AS "timestamp",
    COALESCE(u.full_name, 'System'::text) AS user_fullname,
    u.username,
    u.role AS user_role
   FROM activitylogs a
     LEFT JOIN users u ON u.user_id = a.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | activitylogs_view        | 12              | user_role                            | character varying           |  SELECT a.log_id,
    a.user_id,
    a.action_type,
    a.entity_type,
    a.entity_id,
    a.description,
    a.old_value,
    a.new_value,
    timezone('Asia/Manila'::text, a."timestamp"::timestamp with time zone) AS "timestamp",
    COALESCE(u.full_name, 'System'::text) AS user_fullname,
    u.username,
    u.role AS user_role
   FROM activitylogs a
     LEFT JOIN users u ON u.user_id = a.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | conversations_view       | 1               | conversation_id                      | bigint                      |  WITH last_message_details AS (
         SELECT messages.conversation_id,
            max(messages.created_at) AS last_message_at
           FROM messages
          GROUP BY messages.conversation_id
        ), conversation_participants_details AS (
         SELECT p.conversation_id,
            u.user_id AS participant_id,
            u.full_name AS participant_name,
            u.email AS participant_email
           FROM conversationparticipants p
             JOIN users u ON p.user_id = u.user_id
          WHERE p.user_id <> 1
        )
 SELECT c.conversation_id,
    cpd.participant_id,
    cpd.participant_name,
    cpd.participant_email,
    m.message_content AS last_message,
    lmd.last_message_at,
    ( SELECT count(*) AS count
           FROM message_receipts mr
          WHERE (mr.message_id IN ( SELECT m2.message_id
                   FROM messages m2
                  WHERE m2.conversation_id = c.conversation_id)) AND mr.user_id = 1 AND mr.read_at IS NULL) AS unread_count
   FROM conversations c
     JOIN last_message_details lmd ON c.conversation_id = lmd.conversation_id
     JOIN conversation_participants_details cpd ON c.conversation_id = cpd.conversation_id
     LEFT JOIN messages m ON lmd.conversation_id = m.conversation_id AND lmd.last_message_at = m.created_at;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | conversations_view       | 2               | participant_id                       | bigint                      |  WITH last_message_details AS (
         SELECT messages.conversation_id,
            max(messages.created_at) AS last_message_at
           FROM messages
          GROUP BY messages.conversation_id
        ), conversation_participants_details AS (
         SELECT p.conversation_id,
            u.user_id AS participant_id,
            u.full_name AS participant_name,
            u.email AS participant_email
           FROM conversationparticipants p
             JOIN users u ON p.user_id = u.user_id
          WHERE p.user_id <> 1
        )
 SELECT c.conversation_id,
    cpd.participant_id,
    cpd.participant_name,
    cpd.participant_email,
    m.message_content AS last_message,
    lmd.last_message_at,
    ( SELECT count(*) AS count
           FROM message_receipts mr
          WHERE (mr.message_id IN ( SELECT m2.message_id
                   FROM messages m2
                  WHERE m2.conversation_id = c.conversation_id)) AND mr.user_id = 1 AND mr.read_at IS NULL) AS unread_count
   FROM conversations c
     JOIN last_message_details lmd ON c.conversation_id = lmd.conversation_id
     JOIN conversation_participants_details cpd ON c.conversation_id = cpd.conversation_id
     LEFT JOIN messages m ON lmd.conversation_id = m.conversation_id AND lmd.last_message_at = m.created_at;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | conversations_view       | 3               | participant_name                     | text                        |  WITH last_message_details AS (
         SELECT messages.conversation_id,
            max(messages.created_at) AS last_message_at
           FROM messages
          GROUP BY messages.conversation_id
        ), conversation_participants_details AS (
         SELECT p.conversation_id,
            u.user_id AS participant_id,
            u.full_name AS participant_name,
            u.email AS participant_email
           FROM conversationparticipants p
             JOIN users u ON p.user_id = u.user_id
          WHERE p.user_id <> 1
        )
 SELECT c.conversation_id,
    cpd.participant_id,
    cpd.participant_name,
    cpd.participant_email,
    m.message_content AS last_message,
    lmd.last_message_at,
    ( SELECT count(*) AS count
           FROM message_receipts mr
          WHERE (mr.message_id IN ( SELECT m2.message_id
                   FROM messages m2
                  WHERE m2.conversation_id = c.conversation_id)) AND mr.user_id = 1 AND mr.read_at IS NULL) AS unread_count
   FROM conversations c
     JOIN last_message_details lmd ON c.conversation_id = lmd.conversation_id
     JOIN conversation_participants_details cpd ON c.conversation_id = cpd.conversation_id
     LEFT JOIN messages m ON lmd.conversation_id = m.conversation_id AND lmd.last_message_at = m.created_at;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | conversations_view       | 4               | participant_email                    | character varying           |  WITH last_message_details AS (
         SELECT messages.conversation_id,
            max(messages.created_at) AS last_message_at
           FROM messages
          GROUP BY messages.conversation_id
        ), conversation_participants_details AS (
         SELECT p.conversation_id,
            u.user_id AS participant_id,
            u.full_name AS participant_name,
            u.email AS participant_email
           FROM conversationparticipants p
             JOIN users u ON p.user_id = u.user_id
          WHERE p.user_id <> 1
        )
 SELECT c.conversation_id,
    cpd.participant_id,
    cpd.participant_name,
    cpd.participant_email,
    m.message_content AS last_message,
    lmd.last_message_at,
    ( SELECT count(*) AS count
           FROM message_receipts mr
          WHERE (mr.message_id IN ( SELECT m2.message_id
                   FROM messages m2
                  WHERE m2.conversation_id = c.conversation_id)) AND mr.user_id = 1 AND mr.read_at IS NULL) AS unread_count
   FROM conversations c
     JOIN last_message_details lmd ON c.conversation_id = lmd.conversation_id
     JOIN conversation_participants_details cpd ON c.conversation_id = cpd.conversation_id
     LEFT JOIN messages m ON lmd.conversation_id = m.conversation_id AND lmd.last_message_at = m.created_at;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | conversations_view       | 5               | last_message                         | text                        |  WITH last_message_details AS (
         SELECT messages.conversation_id,
            max(messages.created_at) AS last_message_at
           FROM messages
          GROUP BY messages.conversation_id
        ), conversation_participants_details AS (
         SELECT p.conversation_id,
            u.user_id AS participant_id,
            u.full_name AS participant_name,
            u.email AS participant_email
           FROM conversationparticipants p
             JOIN users u ON p.user_id = u.user_id
          WHERE p.user_id <> 1
        )
 SELECT c.conversation_id,
    cpd.participant_id,
    cpd.participant_name,
    cpd.participant_email,
    m.message_content AS last_message,
    lmd.last_message_at,
    ( SELECT count(*) AS count
           FROM message_receipts mr
          WHERE (mr.message_id IN ( SELECT m2.message_id
                   FROM messages m2
                  WHERE m2.conversation_id = c.conversation_id)) AND mr.user_id = 1 AND mr.read_at IS NULL) AS unread_count
   FROM conversations c
     JOIN last_message_details lmd ON c.conversation_id = lmd.conversation_id
     JOIN conversation_participants_details cpd ON c.conversation_id = cpd.conversation_id
     LEFT JOIN messages m ON lmd.conversation_id = m.conversation_id AND lmd.last_message_at = m.created_at;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | conversations_view       | 6               | last_message_at                      | timestamp without time zone |  WITH last_message_details AS (
         SELECT messages.conversation_id,
            max(messages.created_at) AS last_message_at
           FROM messages
          GROUP BY messages.conversation_id
        ), conversation_participants_details AS (
         SELECT p.conversation_id,
            u.user_id AS participant_id,
            u.full_name AS participant_name,
            u.email AS participant_email
           FROM conversationparticipants p
             JOIN users u ON p.user_id = u.user_id
          WHERE p.user_id <> 1
        )
 SELECT c.conversation_id,
    cpd.participant_id,
    cpd.participant_name,
    cpd.participant_email,
    m.message_content AS last_message,
    lmd.last_message_at,
    ( SELECT count(*) AS count
           FROM message_receipts mr
          WHERE (mr.message_id IN ( SELECT m2.message_id
                   FROM messages m2
                  WHERE m2.conversation_id = c.conversation_id)) AND mr.user_id = 1 AND mr.read_at IS NULL) AS unread_count
   FROM conversations c
     JOIN last_message_details lmd ON c.conversation_id = lmd.conversation_id
     JOIN conversation_participants_details cpd ON c.conversation_id = cpd.conversation_id
     LEFT JOIN messages m ON lmd.conversation_id = m.conversation_id AND lmd.last_message_at = m.created_at;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | conversations_view       | 7               | unread_count                         | bigint                      |  WITH last_message_details AS (
         SELECT messages.conversation_id,
            max(messages.created_at) AS last_message_at
           FROM messages
          GROUP BY messages.conversation_id
        ), conversation_participants_details AS (
         SELECT p.conversation_id,
            u.user_id AS participant_id,
            u.full_name AS participant_name,
            u.email AS participant_email
           FROM conversationparticipants p
             JOIN users u ON p.user_id = u.user_id
          WHERE p.user_id <> 1
        )
 SELECT c.conversation_id,
    cpd.participant_id,
    cpd.participant_name,
    cpd.participant_email,
    m.message_content AS last_message,
    lmd.last_message_at,
    ( SELECT count(*) AS count
           FROM message_receipts mr
          WHERE (mr.message_id IN ( SELECT m2.message_id
                   FROM messages m2
                  WHERE m2.conversation_id = c.conversation_id)) AND mr.user_id = 1 AND mr.read_at IS NULL) AS unread_count
   FROM conversations c
     JOIN last_message_details lmd ON c.conversation_id = lmd.conversation_id
     JOIN conversation_participants_details cpd ON c.conversation_id = cpd.conversation_id
     LEFT JOIN messages m ON lmd.conversation_id = m.conversation_id AND lmd.last_message_at = m.created_at;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public | dashboard_view           | 1               | total_patients                       | bigint                      |  WITH stock AS (
         SELECT COALESCE(sum(inventory.current_stock_level), 0::bigint) AS total_stock
           FROM inventory
          WHERE inventory.is_deleted = false
        ), health_staff_count AS (
         SELECT count(*) AS total_healthstaff
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'HealthStaff'::text
        ), nurses_count AS (
         SELECT count(*) AS total_nurses
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nurse'::text
        ), nutritionists_count AS (
         SELECT count(*) AS total_nutritionists
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nutritionist'::text
        ), guardians_count AS (
         SELECT count(*) AS total_guardians
           FROM guardians
          WHERE COALESCE(guardians.is_deleted, false) = false
        ), defaulters_count AS (
         SELECT count(*) AS total_defaulters
           FROM defaulters_view
        ), due_soon_count AS (
         SELECT count(*) AS total_due_soon
           FROM duesoon_view
        ), stock_by_category AS (
         SELECT jsonb_object_agg(sub.category, sub.total_stock) AS stock_by_category
           FROM ( SELECT v.category,
                    COALESCE(sum(i.current_stock_level), 0::bigint) AS total_stock
                   FROM inventory i
                     JOIN vaccinemaster v ON i.vaccine_id = v.vaccine_id
                  WHERE i.is_deleted = false
                  GROUP BY v.category) sub
        )
 SELECT ( SELECT count(*) AS count
           FROM patients
          WHERE COALESCE(patients.is_deleted, false) = false) AS total_patients,
    ( SELECT health_staff_count.total_healthstaff
           FROM health_staff_count) AS total_healthstaff,
    ( SELECT nurses_count.total_nurses
           FROM nurses_count) AS total_nurses,
    ( SELECT nutritionists_count.total_nutritionists
           FROM nutritionists_count) AS total_nutritionists,
    ( SELECT guardians_count.total_guardians
           FROM guardians_count) AS total_guardians,
    ( SELECT stock.total_stock
           FROM stock) AS total_vaccine_stock,
    ( SELECT defaulters_count.total_defaulters
           FROM defaulters_count) AS total_defaulters,
    ( SELECT due_soon_count.total_due_soon
           FROM due_soon_count) AS total_due_soon,
    ( SELECT stock_by_category.stock_by_category
           FROM stock_by_category) AS stock_by_category;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| public | dashboard_view           | 2               | total_healthstaff                    | bigint                      |  WITH stock AS (
         SELECT COALESCE(sum(inventory.current_stock_level), 0::bigint) AS total_stock
           FROM inventory
          WHERE inventory.is_deleted = false
        ), health_staff_count AS (
         SELECT count(*) AS total_healthstaff
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'HealthStaff'::text
        ), nurses_count AS (
         SELECT count(*) AS total_nurses
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nurse'::text
        ), nutritionists_count AS (
         SELECT count(*) AS total_nutritionists
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nutritionist'::text
        ), guardians_count AS (
         SELECT count(*) AS total_guardians
           FROM guardians
          WHERE COALESCE(guardians.is_deleted, false) = false
        ), defaulters_count AS (
         SELECT count(*) AS total_defaulters
           FROM defaulters_view
        ), due_soon_count AS (
         SELECT count(*) AS total_due_soon
           FROM duesoon_view
        ), stock_by_category AS (
         SELECT jsonb_object_agg(sub.category, sub.total_stock) AS stock_by_category
           FROM ( SELECT v.category,
                    COALESCE(sum(i.current_stock_level), 0::bigint) AS total_stock
                   FROM inventory i
                     JOIN vaccinemaster v ON i.vaccine_id = v.vaccine_id
                  WHERE i.is_deleted = false
                  GROUP BY v.category) sub
        )
 SELECT ( SELECT count(*) AS count
           FROM patients
          WHERE COALESCE(patients.is_deleted, false) = false) AS total_patients,
    ( SELECT health_staff_count.total_healthstaff
           FROM health_staff_count) AS total_healthstaff,
    ( SELECT nurses_count.total_nurses
           FROM nurses_count) AS total_nurses,
    ( SELECT nutritionists_count.total_nutritionists
           FROM nutritionists_count) AS total_nutritionists,
    ( SELECT guardians_count.total_guardians
           FROM guardians_count) AS total_guardians,
    ( SELECT stock.total_stock
           FROM stock) AS total_vaccine_stock,
    ( SELECT defaulters_count.total_defaulters
           FROM defaulters_count) AS total_defaulters,
    ( SELECT due_soon_count.total_due_soon
           FROM due_soon_count) AS total_due_soon,
    ( SELECT stock_by_category.stock_by_category
           FROM stock_by_category) AS stock_by_category;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| public | dashboard_view           | 3               | total_nurses                         | bigint                      |  WITH stock AS (
         SELECT COALESCE(sum(inventory.current_stock_level), 0::bigint) AS total_stock
           FROM inventory
          WHERE inventory.is_deleted = false
        ), health_staff_count AS (
         SELECT count(*) AS total_healthstaff
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'HealthStaff'::text
        ), nurses_count AS (
         SELECT count(*) AS total_nurses
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nurse'::text
        ), nutritionists_count AS (
         SELECT count(*) AS total_nutritionists
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nutritionist'::text
        ), guardians_count AS (
         SELECT count(*) AS total_guardians
           FROM guardians
          WHERE COALESCE(guardians.is_deleted, false) = false
        ), defaulters_count AS (
         SELECT count(*) AS total_defaulters
           FROM defaulters_view
        ), due_soon_count AS (
         SELECT count(*) AS total_due_soon
           FROM duesoon_view
        ), stock_by_category AS (
         SELECT jsonb_object_agg(sub.category, sub.total_stock) AS stock_by_category
           FROM ( SELECT v.category,
                    COALESCE(sum(i.current_stock_level), 0::bigint) AS total_stock
                   FROM inventory i
                     JOIN vaccinemaster v ON i.vaccine_id = v.vaccine_id
                  WHERE i.is_deleted = false
                  GROUP BY v.category) sub
        )
 SELECT ( SELECT count(*) AS count
           FROM patients
          WHERE COALESCE(patients.is_deleted, false) = false) AS total_patients,
    ( SELECT health_staff_count.total_healthstaff
           FROM health_staff_count) AS total_healthstaff,
    ( SELECT nurses_count.total_nurses
           FROM nurses_count) AS total_nurses,
    ( SELECT nutritionists_count.total_nutritionists
           FROM nutritionists_count) AS total_nutritionists,
    ( SELECT guardians_count.total_guardians
           FROM guardians_count) AS total_guardians,
    ( SELECT stock.total_stock
           FROM stock) AS total_vaccine_stock,
    ( SELECT defaulters_count.total_defaulters
           FROM defaulters_count) AS total_defaulters,
    ( SELECT due_soon_count.total_due_soon
           FROM due_soon_count) AS total_due_soon,
    ( SELECT stock_by_category.stock_by_category
           FROM stock_by_category) AS stock_by_category;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| public | dashboard_view           | 4               | total_nutritionists                  | bigint                      |  WITH stock AS (
         SELECT COALESCE(sum(inventory.current_stock_level), 0::bigint) AS total_stock
           FROM inventory
          WHERE inventory.is_deleted = false
        ), health_staff_count AS (
         SELECT count(*) AS total_healthstaff
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'HealthStaff'::text
        ), nurses_count AS (
         SELECT count(*) AS total_nurses
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nurse'::text
        ), nutritionists_count AS (
         SELECT count(*) AS total_nutritionists
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nutritionist'::text
        ), guardians_count AS (
         SELECT count(*) AS total_guardians
           FROM guardians
          WHERE COALESCE(guardians.is_deleted, false) = false
        ), defaulters_count AS (
         SELECT count(*) AS total_defaulters
           FROM defaulters_view
        ), due_soon_count AS (
         SELECT count(*) AS total_due_soon
           FROM duesoon_view
        ), stock_by_category AS (
         SELECT jsonb_object_agg(sub.category, sub.total_stock) AS stock_by_category
           FROM ( SELECT v.category,
                    COALESCE(sum(i.current_stock_level), 0::bigint) AS total_stock
                   FROM inventory i
                     JOIN vaccinemaster v ON i.vaccine_id = v.vaccine_id
                  WHERE i.is_deleted = false
                  GROUP BY v.category) sub
        )
 SELECT ( SELECT count(*) AS count
           FROM patients
          WHERE COALESCE(patients.is_deleted, false) = false) AS total_patients,
    ( SELECT health_staff_count.total_healthstaff
           FROM health_staff_count) AS total_healthstaff,
    ( SELECT nurses_count.total_nurses
           FROM nurses_count) AS total_nurses,
    ( SELECT nutritionists_count.total_nutritionists
           FROM nutritionists_count) AS total_nutritionists,
    ( SELECT guardians_count.total_guardians
           FROM guardians_count) AS total_guardians,
    ( SELECT stock.total_stock
           FROM stock) AS total_vaccine_stock,
    ( SELECT defaulters_count.total_defaulters
           FROM defaulters_count) AS total_defaulters,
    ( SELECT due_soon_count.total_due_soon
           FROM due_soon_count) AS total_due_soon,
    ( SELECT stock_by_category.stock_by_category
           FROM stock_by_category) AS stock_by_category;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| public | dashboard_view           | 5               | total_guardians                      | bigint                      |  WITH stock AS (
         SELECT COALESCE(sum(inventory.current_stock_level), 0::bigint) AS total_stock
           FROM inventory
          WHERE inventory.is_deleted = false
        ), health_staff_count AS (
         SELECT count(*) AS total_healthstaff
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'HealthStaff'::text
        ), nurses_count AS (
         SELECT count(*) AS total_nurses
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nurse'::text
        ), nutritionists_count AS (
         SELECT count(*) AS total_nutritionists
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nutritionist'::text
        ), guardians_count AS (
         SELECT count(*) AS total_guardians
           FROM guardians
          WHERE COALESCE(guardians.is_deleted, false) = false
        ), defaulters_count AS (
         SELECT count(*) AS total_defaulters
           FROM defaulters_view
        ), due_soon_count AS (
         SELECT count(*) AS total_due_soon
           FROM duesoon_view
        ), stock_by_category AS (
         SELECT jsonb_object_agg(sub.category, sub.total_stock) AS stock_by_category
           FROM ( SELECT v.category,
                    COALESCE(sum(i.current_stock_level), 0::bigint) AS total_stock
                   FROM inventory i
                     JOIN vaccinemaster v ON i.vaccine_id = v.vaccine_id
                  WHERE i.is_deleted = false
                  GROUP BY v.category) sub
        )
 SELECT ( SELECT count(*) AS count
           FROM patients
          WHERE COALESCE(patients.is_deleted, false) = false) AS total_patients,
    ( SELECT health_staff_count.total_healthstaff
           FROM health_staff_count) AS total_healthstaff,
    ( SELECT nurses_count.total_nurses
           FROM nurses_count) AS total_nurses,
    ( SELECT nutritionists_count.total_nutritionists
           FROM nutritionists_count) AS total_nutritionists,
    ( SELECT guardians_count.total_guardians
           FROM guardians_count) AS total_guardians,
    ( SELECT stock.total_stock
           FROM stock) AS total_vaccine_stock,
    ( SELECT defaulters_count.total_defaulters
           FROM defaulters_count) AS total_defaulters,
    ( SELECT due_soon_count.total_due_soon
           FROM due_soon_count) AS total_due_soon,
    ( SELECT stock_by_category.stock_by_category
           FROM stock_by_category) AS stock_by_category;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| public | dashboard_view           | 6               | total_vaccine_stock                  | bigint                      |  WITH stock AS (
         SELECT COALESCE(sum(inventory.current_stock_level), 0::bigint) AS total_stock
           FROM inventory
          WHERE inventory.is_deleted = false
        ), health_staff_count AS (
         SELECT count(*) AS total_healthstaff
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'HealthStaff'::text
        ), nurses_count AS (
         SELECT count(*) AS total_nurses
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nurse'::text
        ), nutritionists_count AS (
         SELECT count(*) AS total_nutritionists
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nutritionist'::text
        ), guardians_count AS (
         SELECT count(*) AS total_guardians
           FROM guardians
          WHERE COALESCE(guardians.is_deleted, false) = false
        ), defaulters_count AS (
         SELECT count(*) AS total_defaulters
           FROM defaulters_view
        ), due_soon_count AS (
         SELECT count(*) AS total_due_soon
           FROM duesoon_view
        ), stock_by_category AS (
         SELECT jsonb_object_agg(sub.category, sub.total_stock) AS stock_by_category
           FROM ( SELECT v.category,
                    COALESCE(sum(i.current_stock_level), 0::bigint) AS total_stock
                   FROM inventory i
                     JOIN vaccinemaster v ON i.vaccine_id = v.vaccine_id
                  WHERE i.is_deleted = false
                  GROUP BY v.category) sub
        )
 SELECT ( SELECT count(*) AS count
           FROM patients
          WHERE COALESCE(patients.is_deleted, false) = false) AS total_patients,
    ( SELECT health_staff_count.total_healthstaff
           FROM health_staff_count) AS total_healthstaff,
    ( SELECT nurses_count.total_nurses
           FROM nurses_count) AS total_nurses,
    ( SELECT nutritionists_count.total_nutritionists
           FROM nutritionists_count) AS total_nutritionists,
    ( SELECT guardians_count.total_guardians
           FROM guardians_count) AS total_guardians,
    ( SELECT stock.total_stock
           FROM stock) AS total_vaccine_stock,
    ( SELECT defaulters_count.total_defaulters
           FROM defaulters_count) AS total_defaulters,
    ( SELECT due_soon_count.total_due_soon
           FROM due_soon_count) AS total_due_soon,
    ( SELECT stock_by_category.stock_by_category
           FROM stock_by_category) AS stock_by_category;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| public | dashboard_view           | 7               | total_defaulters                     | bigint                      |  WITH stock AS (
         SELECT COALESCE(sum(inventory.current_stock_level), 0::bigint) AS total_stock
           FROM inventory
          WHERE inventory.is_deleted = false
        ), health_staff_count AS (
         SELECT count(*) AS total_healthstaff
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'HealthStaff'::text
        ), nurses_count AS (
         SELECT count(*) AS total_nurses
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nurse'::text
        ), nutritionists_count AS (
         SELECT count(*) AS total_nutritionists
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nutritionist'::text
        ), guardians_count AS (
         SELECT count(*) AS total_guardians
           FROM guardians
          WHERE COALESCE(guardians.is_deleted, false) = false
        ), defaulters_count AS (
         SELECT count(*) AS total_defaulters
           FROM defaulters_view
        ), due_soon_count AS (
         SELECT count(*) AS total_due_soon
           FROM duesoon_view
        ), stock_by_category AS (
         SELECT jsonb_object_agg(sub.category, sub.total_stock) AS stock_by_category
           FROM ( SELECT v.category,
                    COALESCE(sum(i.current_stock_level), 0::bigint) AS total_stock
                   FROM inventory i
                     JOIN vaccinemaster v ON i.vaccine_id = v.vaccine_id
                  WHERE i.is_deleted = false
                  GROUP BY v.category) sub
        )
 SELECT ( SELECT count(*) AS count
           FROM patients
          WHERE COALESCE(patients.is_deleted, false) = false) AS total_patients,
    ( SELECT health_staff_count.total_healthstaff
           FROM health_staff_count) AS total_healthstaff,
    ( SELECT nurses_count.total_nurses
           FROM nurses_count) AS total_nurses,
    ( SELECT nutritionists_count.total_nutritionists
           FROM nutritionists_count) AS total_nutritionists,
    ( SELECT guardians_count.total_guardians
           FROM guardians_count) AS total_guardians,
    ( SELECT stock.total_stock
           FROM stock) AS total_vaccine_stock,
    ( SELECT defaulters_count.total_defaulters
           FROM defaulters_count) AS total_defaulters,
    ( SELECT due_soon_count.total_due_soon
           FROM due_soon_count) AS total_due_soon,
    ( SELECT stock_by_category.stock_by_category
           FROM stock_by_category) AS stock_by_category;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| public | dashboard_view           | 8               | total_due_soon                       | bigint                      |  WITH stock AS (
         SELECT COALESCE(sum(inventory.current_stock_level), 0::bigint) AS total_stock
           FROM inventory
          WHERE inventory.is_deleted = false
        ), health_staff_count AS (
         SELECT count(*) AS total_healthstaff
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'HealthStaff'::text
        ), nurses_count AS (
         SELECT count(*) AS total_nurses
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nurse'::text
        ), nutritionists_count AS (
         SELECT count(*) AS total_nutritionists
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nutritionist'::text
        ), guardians_count AS (
         SELECT count(*) AS total_guardians
           FROM guardians
          WHERE COALESCE(guardians.is_deleted, false) = false
        ), defaulters_count AS (
         SELECT count(*) AS total_defaulters
           FROM defaulters_view
        ), due_soon_count AS (
         SELECT count(*) AS total_due_soon
           FROM duesoon_view
        ), stock_by_category AS (
         SELECT jsonb_object_agg(sub.category, sub.total_stock) AS stock_by_category
           FROM ( SELECT v.category,
                    COALESCE(sum(i.current_stock_level), 0::bigint) AS total_stock
                   FROM inventory i
                     JOIN vaccinemaster v ON i.vaccine_id = v.vaccine_id
                  WHERE i.is_deleted = false
                  GROUP BY v.category) sub
        )
 SELECT ( SELECT count(*) AS count
           FROM patients
          WHERE COALESCE(patients.is_deleted, false) = false) AS total_patients,
    ( SELECT health_staff_count.total_healthstaff
           FROM health_staff_count) AS total_healthstaff,
    ( SELECT nurses_count.total_nurses
           FROM nurses_count) AS total_nurses,
    ( SELECT nutritionists_count.total_nutritionists
           FROM nutritionists_count) AS total_nutritionists,
    ( SELECT guardians_count.total_guardians
           FROM guardians_count) AS total_guardians,
    ( SELECT stock.total_stock
           FROM stock) AS total_vaccine_stock,
    ( SELECT defaulters_count.total_defaulters
           FROM defaulters_count) AS total_defaulters,
    ( SELECT due_soon_count.total_due_soon
           FROM due_soon_count) AS total_due_soon,
    ( SELECT stock_by_category.stock_by_category
           FROM stock_by_category) AS stock_by_category;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| public | dashboard_view           | 9               | stock_by_category                    | jsonb                       |  WITH stock AS (
         SELECT COALESCE(sum(inventory.current_stock_level), 0::bigint) AS total_stock
           FROM inventory
          WHERE inventory.is_deleted = false
        ), health_staff_count AS (
         SELECT count(*) AS total_healthstaff
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'HealthStaff'::text
        ), nurses_count AS (
         SELECT count(*) AS total_nurses
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nurse'::text
        ), nutritionists_count AS (
         SELECT count(*) AS total_nutritionists
           FROM users
          WHERE COALESCE(users.is_deleted, false) = false AND users.role::text = 'Nutritionist'::text
        ), guardians_count AS (
         SELECT count(*) AS total_guardians
           FROM guardians
          WHERE COALESCE(guardians.is_deleted, false) = false
        ), defaulters_count AS (
         SELECT count(*) AS total_defaulters
           FROM defaulters_view
        ), due_soon_count AS (
         SELECT count(*) AS total_due_soon
           FROM duesoon_view
        ), stock_by_category AS (
         SELECT jsonb_object_agg(sub.category, sub.total_stock) AS stock_by_category
           FROM ( SELECT v.category,
                    COALESCE(sum(i.current_stock_level), 0::bigint) AS total_stock
                   FROM inventory i
                     JOIN vaccinemaster v ON i.vaccine_id = v.vaccine_id
                  WHERE i.is_deleted = false
                  GROUP BY v.category) sub
        )
 SELECT ( SELECT count(*) AS count
           FROM patients
          WHERE COALESCE(patients.is_deleted, false) = false) AS total_patients,
    ( SELECT health_staff_count.total_healthstaff
           FROM health_staff_count) AS total_healthstaff,
    ( SELECT nurses_count.total_nurses
           FROM nurses_count) AS total_nurses,
    ( SELECT nutritionists_count.total_nutritionists
           FROM nutritionists_count) AS total_nutritionists,
    ( SELECT guardians_count.total_guardians
           FROM guardians_count) AS total_guardians,
    ( SELECT stock.total_stock
           FROM stock) AS total_vaccine_stock,
    ( SELECT defaulters_count.total_defaulters
           FROM defaulters_count) AS total_defaulters,
    ( SELECT due_soon_count.total_due_soon
           FROM due_soon_count) AS total_due_soon,
    ( SELECT stock_by_category.stock_by_category
           FROM stock_by_category) AS stock_by_category;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| public | defaulters_view          | 1               | patient_id                           | bigint                      |  SELECT p.patient_id,
    p.full_name AS patient_name,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number,
    p.barangay,
    s.vaccine_id,
    vm.antigen_name AS next_due_antigen,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    'Overdue'::text AS status,
    GREATEST(CURRENT_DATE - s.scheduled_date, 0) AS days_overdue
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | defaulters_view          | 2               | patient_name                         | text                        |  SELECT p.patient_id,
    p.full_name AS patient_name,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number,
    p.barangay,
    s.vaccine_id,
    vm.antigen_name AS next_due_antigen,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    'Overdue'::text AS status,
    GREATEST(CURRENT_DATE - s.scheduled_date, 0) AS days_overdue
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | defaulters_view          | 3               | guardian_name                        | text                        |  SELECT p.patient_id,
    p.full_name AS patient_name,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number,
    p.barangay,
    s.vaccine_id,
    vm.antigen_name AS next_due_antigen,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    'Overdue'::text AS status,
    GREATEST(CURRENT_DATE - s.scheduled_date, 0) AS days_overdue
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | defaulters_view          | 4               | contact_number                       | character varying           |  SELECT p.patient_id,
    p.full_name AS patient_name,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number,
    p.barangay,
    s.vaccine_id,
    vm.antigen_name AS next_due_antigen,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    'Overdue'::text AS status,
    GREATEST(CURRENT_DATE - s.scheduled_date, 0) AS days_overdue
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | defaulters_view          | 5               | barangay                             | character varying           |  SELECT p.patient_id,
    p.full_name AS patient_name,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number,
    p.barangay,
    s.vaccine_id,
    vm.antigen_name AS next_due_antigen,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    'Overdue'::text AS status,
    GREATEST(CURRENT_DATE - s.scheduled_date, 0) AS days_overdue
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | defaulters_view          | 6               | vaccine_id                           | bigint                      |  SELECT p.patient_id,
    p.full_name AS patient_name,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number,
    p.barangay,
    s.vaccine_id,
    vm.antigen_name AS next_due_antigen,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    'Overdue'::text AS status,
    GREATEST(CURRENT_DATE - s.scheduled_date, 0) AS days_overdue
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | defaulters_view          | 7               | next_due_antigen                     | character varying           |  SELECT p.patient_id,
    p.full_name AS patient_name,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number,
    p.barangay,
    s.vaccine_id,
    vm.antigen_name AS next_due_antigen,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    'Overdue'::text AS status,
    GREATEST(CURRENT_DATE - s.scheduled_date, 0) AS days_overdue
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | defaulters_view          | 8               | category                             | USER-DEFINED                |  SELECT p.patient_id,
    p.full_name AS patient_name,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number,
    p.barangay,
    s.vaccine_id,
    vm.antigen_name AS next_due_antigen,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    'Overdue'::text AS status,
    GREATEST(CURRENT_DATE - s.scheduled_date, 0) AS days_overdue
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | defaulters_view          | 9               | dose_number                          | integer                     |  SELECT p.patient_id,
    p.full_name AS patient_name,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number,
    p.barangay,
    s.vaccine_id,
    vm.antigen_name AS next_due_antigen,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    'Overdue'::text AS status,
    GREATEST(CURRENT_DATE - s.scheduled_date, 0) AS days_overdue
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | defaulters_view          | 10              | scheduled_date                       | date                        |  SELECT p.patient_id,
    p.full_name AS patient_name,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number,
    p.barangay,
    s.vaccine_id,
    vm.antigen_name AS next_due_antigen,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    'Overdue'::text AS status,
    GREATEST(CURRENT_DATE - s.scheduled_date, 0) AS days_overdue
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | defaulters_view          | 11              | status                               | text                        |  SELECT p.patient_id,
    p.full_name AS patient_name,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number,
    p.barangay,
    s.vaccine_id,
    vm.antigen_name AS next_due_antigen,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    'Overdue'::text AS status,
    GREATEST(CURRENT_DATE - s.scheduled_date, 0) AS days_overdue
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | defaulters_view          | 12              | days_overdue                         | integer                     |  SELECT p.patient_id,
    p.full_name AS patient_name,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number,
    p.barangay,
    s.vaccine_id,
    vm.antigen_name AS next_due_antigen,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    'Overdue'::text AS status,
    GREATEST(CURRENT_DATE - s.scheduled_date, 0) AS days_overdue
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | duesoon_view             | 1               | patient_id                           | bigint                      |  SELECT p.patient_id,
    p.full_name AS patient_name,
    g.contact_number AS guardian_contact,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    GREATEST(s.scheduled_date - CURRENT_DATE, 0) AS days_until_due
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date >= CURRENT_DATE AND s.scheduled_date <= (CURRENT_DATE + '7 days'::interval);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | duesoon_view             | 2               | patient_name                         | text                        |  SELECT p.patient_id,
    p.full_name AS patient_name,
    g.contact_number AS guardian_contact,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    GREATEST(s.scheduled_date - CURRENT_DATE, 0) AS days_until_due
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date >= CURRENT_DATE AND s.scheduled_date <= (CURRENT_DATE + '7 days'::interval);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | duesoon_view             | 3               | guardian_contact                     | character varying           |  SELECT p.patient_id,
    p.full_name AS patient_name,
    g.contact_number AS guardian_contact,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    GREATEST(s.scheduled_date - CURRENT_DATE, 0) AS days_until_due
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date >= CURRENT_DATE AND s.scheduled_date <= (CURRENT_DATE + '7 days'::interval);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | duesoon_view             | 4               | antigen_name                         | character varying           |  SELECT p.patient_id,
    p.full_name AS patient_name,
    g.contact_number AS guardian_contact,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    GREATEST(s.scheduled_date - CURRENT_DATE, 0) AS days_until_due
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date >= CURRENT_DATE AND s.scheduled_date <= (CURRENT_DATE + '7 days'::interval);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | duesoon_view             | 5               | category                             | USER-DEFINED                |  SELECT p.patient_id,
    p.full_name AS patient_name,
    g.contact_number AS guardian_contact,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    GREATEST(s.scheduled_date - CURRENT_DATE, 0) AS days_until_due
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date >= CURRENT_DATE AND s.scheduled_date <= (CURRENT_DATE + '7 days'::interval);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | duesoon_view             | 6               | dose_number                          | integer                     |  SELECT p.patient_id,
    p.full_name AS patient_name,
    g.contact_number AS guardian_contact,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    GREATEST(s.scheduled_date - CURRENT_DATE, 0) AS days_until_due
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date >= CURRENT_DATE AND s.scheduled_date <= (CURRENT_DATE + '7 days'::interval);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | duesoon_view             | 7               | scheduled_date                       | date                        |  SELECT p.patient_id,
    p.full_name AS patient_name,
    g.contact_number AS guardian_contact,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    GREATEST(s.scheduled_date - CURRENT_DATE, 0) AS days_until_due
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date >= CURRENT_DATE AND s.scheduled_date <= (CURRENT_DATE + '7 days'::interval);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | duesoon_view             | 8               | days_until_due                       | integer                     |  SELECT p.patient_id,
    p.full_name AS patient_name,
    g.contact_number AS guardian_contact,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    GREATEST(s.scheduled_date - CURRENT_DATE, 0) AS days_until_due
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false AND s.actual_date IS NULL AND s.scheduled_date >= CURRENT_DATE AND s.scheduled_date <= (CURRENT_DATE + '7 days'::interval);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | immunizationhistory_view | 1               | immunization_id                      | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 2               | visit_id                             | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 3               | vaccine_id                           | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 4               | inventory_id                         | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 5               | dose_number                          | integer                     |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 6               | administered_by_id                   | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 7               | administered_by_name                 | text                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 8               | remarks                              | text                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 9               | immunization_is_deleted              | boolean                     |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 10              | immunization_deleted_at              | timestamp without time zone |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 11              | immunization_deleted_by              | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 12              | immunization_created_at              | timestamp with time zone    |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 13              | immunization_created_by              | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 14              | immunization_updated_at              | timestamp with time zone    |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 15              | immunization_updated_by              | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 16              | administered_date                    | date                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 17              | age_at_administration                | text                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 18              | disease_prevented                    | text                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 19              | immunization_facility_name           | text                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 20              | immunization_outside                 | boolean                     |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 21              | patient_id                           | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 22              | patient_surname                      | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 23              | patient_firstname                    | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 24              | patient_middlename                   | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 25              | patient_full_name                    | text                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 26              | patient_date_of_birth                | date                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 27              | patient_sex                          | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 28              | patient_address                      | text                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 29              | patient_barangay                     | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 30              | patient_health_center                | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 31              | patient_family_number                | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 32              | patient_guardian_id                  | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 33              | patient_date_registered              | timestamp without time zone |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 34              | patient_is_deleted                   | boolean                     |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 35              | patient_tag                          | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 36              | patient_guardian_full_name           | text                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 37              | vaccine_antigen_name                 | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 38              | vaccine_brand_name                   | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 39              | vaccine_manufacturer                 | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 40              | vaccine_type                         | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 41              | vaccine_category                     | USER-DEFINED                |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 42              | vaccine_is_nip                       | boolean                     |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 43              | vaccine_created_by                   | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 44              | vaccine_updated_by                   | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 45              | schedule_id                          | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 46              | schedule_vaccine_id                  | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 47              | schedule_total_doses                 | integer                     |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 48              | schedule_concurrent_allowed          | boolean                     |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 49              | schedule_code                        | text                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 50              | schedule_name                        | text                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 51              | schedule_min_age_days                | integer                     |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 52              | schedule_max_age_days                | integer                     |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 53              | schedule_catchup_strategy            | text                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 54              | schedule_notes                       | text                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 55              | schedule_dose_id                     | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 56              | schedule_dose_schedule_id            | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 57              | schedule_dose_number                 | integer                     |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 58              | schedule_dose_due_after_days         | integer                     |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 59              | schedule_dose_min_interval_days      | integer                     |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 60              | schedule_dose_max_interval_days      | integer                     |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 61              | schedule_dose_min_interval_other_vax | integer                     |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 62              | schedule_dose_notes                  | text                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 63              | patient_schedule_id                  | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 64              | patient_schedule_vaccine_id          | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 65              | patient_schedule_dose_number         | integer                     |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 66              | patient_scheduled_date               | date                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 67              | patient_eligible_date                | date                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 68              | patient_actual_date                  | date                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 69              | patient_schedule_status              | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 70              | patient_schedule_created_by          | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 71              | patient_schedule_updated_by          | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 72              | admin_user_id                        | bigint                      |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 73              | admin_username                       | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 74              | admin_email                          | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 75              | admin_firstname                      | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 76              | admin_surname                        | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 77              | admin_hs_type                        | text                        |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | immunizationhistory_view | 78              | admin_role                           | character varying           |  SELECT im.immunization_id,
    im.visit_id,
    im.vaccine_id,
    im.inventory_id,
    im.dose_number,
    im.administered_by AS administered_by_id,
    COALESCE(NULLIF(btrim((COALESCE(u.firstname, ''::character varying)::text ||
        CASE
            WHEN u.middlename IS NULL OR u.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || u.middlename::text
        END) ||
        CASE
            WHEN u.surname IS NULL OR u.surname::text = ''::text THEN ''::text
            ELSE ' '::text || u.surname::text
        END), ''::text), u.username::text) AS administered_by_name,
    im.remarks,
    im.is_deleted AS immunization_is_deleted,
    im.deleted_at AS immunization_deleted_at,
    im.deleted_by AS immunization_deleted_by,
    im.created_at AS immunization_created_at,
    im.created_by AS immunization_created_by,
    im.updated_at AS immunization_updated_at,
    im.updated_by AS immunization_updated_by,
    im.administered_date,
    im.age_at_administration,
    im.disease_prevented,
    im.facility_name AS immunization_facility_name,
    im.outside AS immunization_outside,
    im.patient_id,
    p.surname AS patient_surname,
    p.firstname AS patient_firstname,
    p.middlename AS patient_middlename,
    btrim((COALESCE(p.firstname, ''::character varying)::text ||
        CASE
            WHEN p.middlename IS NULL OR p.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || p.middlename::text
        END) ||
        CASE
            WHEN p.surname IS NULL OR p.surname::text = ''::text THEN ''::text
            ELSE ' '::text || p.surname::text
        END) AS patient_full_name,
    p.date_of_birth AS patient_date_of_birth,
    p.sex AS patient_sex,
    p.address AS patient_address,
    p.barangay AS patient_barangay,
    p.health_center AS patient_health_center,
    p.family_number AS patient_family_number,
    p.guardian_id AS patient_guardian_id,
    p.date_registered AS patient_date_registered,
    p.is_deleted AS patient_is_deleted,
    p.tags AS patient_tag,
    btrim((COALESCE(g.firstname, ''::character varying)::text ||
        CASE
            WHEN g.middlename IS NULL OR g.middlename::text = ''::text THEN ''::text
            ELSE ' '::text || g.middlename::text
        END) ||
        CASE
            WHEN g.surname IS NULL OR g.surname::text = ''::text THEN ''::text
            ELSE ' '::text || g.surname::text
        END) AS patient_guardian_full_name,
    vm.antigen_name AS vaccine_antigen_name,
    vm.brand_name AS vaccine_brand_name,
    vm.manufacturer AS vaccine_manufacturer,
    vm.vaccine_type,
    vm.category AS vaccine_category,
    vm.is_nip AS vaccine_is_nip,
    vm.created_by AS vaccine_created_by,
    vm.updated_by AS vaccine_updated_by,
    sm.id AS schedule_id,
    sm.vaccine_id AS schedule_vaccine_id,
    sm.total_doses AS schedule_total_doses,
    sm.concurrent_allowed AS schedule_concurrent_allowed,
    sm.code AS schedule_code,
    sm.name AS schedule_name,
    sm.min_age_days AS schedule_min_age_days,
    sm.max_age_days AS schedule_max_age_days,
    sm.catchup_strategy AS schedule_catchup_strategy,
    sm.notes AS schedule_notes,
    sd.id AS schedule_dose_id,
    sd.schedule_id AS schedule_dose_schedule_id,
    sd.dose_number AS schedule_dose_number,
    sd.due_after_days AS schedule_dose_due_after_days,
    sd.min_interval_days AS schedule_dose_min_interval_days,
    sd.max_interval_days AS schedule_dose_max_interval_days,
    sd.min_interval_other_vax AS schedule_dose_min_interval_other_vax,
    sd.notes AS schedule_dose_notes,
    ps.patient_schedule_id,
    ps.vaccine_id AS patient_schedule_vaccine_id,
    ps.dose_number AS patient_schedule_dose_number,
    ps.scheduled_date AS patient_scheduled_date,
    ps.eligible_date AS patient_eligible_date,
    ps.actual_date AS patient_actual_date,
    ps.status AS patient_schedule_status,
    ps.created_by AS patient_schedule_created_by,
    ps.updated_by AS patient_schedule_updated_by,
    u.user_id AS admin_user_id,
    u.username AS admin_username,
    u.email AS admin_email,
    u.firstname AS admin_firstname,
    u.surname AS admin_surname,
    u.hs_type AS admin_hs_type,
    u.role AS admin_role
   FROM immunizations im
     LEFT JOIN patients p ON im.patient_id = p.patient_id
     LEFT JOIN guardians g ON p.guardian_id = g.guardian_id
     LEFT JOIN vaccinemaster vm ON im.vaccine_id = vm.vaccine_id
     LEFT JOIN schedule_master sm ON vm.vaccine_id = sm.vaccine_id
     LEFT JOIN schedule_doses sd ON sd.schedule_id = sm.id AND sd.dose_number = im.dose_number
     LEFT JOIN patientschedule ps ON ps.patient_id = im.patient_id AND (ps.vaccine_id = im.vaccine_id OR ps.vaccine_id IS NULL) AND ps.dose_number = im.dose_number
     LEFT JOIN users u ON im.administered_by = u.user_id;                                                                                                                                                                                                                               |
| public | inventorylowstock_view   | 1               | vaccine_id                           | bigint                      |  WITH inv AS (
         SELECT i.vaccine_id,
            COALESCE(sum(i.current_stock_level), 0::bigint) AS current_stock_level,
            sum(
                CASE
                    WHEN i.expiration_date <= (CURRENT_DATE + '30 days'::interval) AND COALESCE(i.current_stock_level, 0) > 0 THEN 1
                    ELSE 0
                END) AS expiration_soon_count
           FROM inventory i
          WHERE COALESCE(i.is_deleted, false) = false
          GROUP BY i.vaccine_id
        )
 SELECT vm.vaccine_id,
    vm.antigen_name,
    vm.brand_name,
    vm.category,
    COALESCE(inv.current_stock_level, 0::bigint) AS current_stock_level,
    COALESCE(inv.expiration_soon_count, 0::bigint) AS expiration_soon_count,
    10 AS minimum_threshold
   FROM vaccinemaster vm
     LEFT JOIN inv ON inv.vaccine_id = vm.vaccine_id
  WHERE COALESCE(vm.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public | inventorylowstock_view   | 2               | antigen_name                         | character varying           |  WITH inv AS (
         SELECT i.vaccine_id,
            COALESCE(sum(i.current_stock_level), 0::bigint) AS current_stock_level,
            sum(
                CASE
                    WHEN i.expiration_date <= (CURRENT_DATE + '30 days'::interval) AND COALESCE(i.current_stock_level, 0) > 0 THEN 1
                    ELSE 0
                END) AS expiration_soon_count
           FROM inventory i
          WHERE COALESCE(i.is_deleted, false) = false
          GROUP BY i.vaccine_id
        )
 SELECT vm.vaccine_id,
    vm.antigen_name,
    vm.brand_name,
    vm.category,
    COALESCE(inv.current_stock_level, 0::bigint) AS current_stock_level,
    COALESCE(inv.expiration_soon_count, 0::bigint) AS expiration_soon_count,
    10 AS minimum_threshold
   FROM vaccinemaster vm
     LEFT JOIN inv ON inv.vaccine_id = vm.vaccine_id
  WHERE COALESCE(vm.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public | inventorylowstock_view   | 3               | brand_name                           | character varying           |  WITH inv AS (
         SELECT i.vaccine_id,
            COALESCE(sum(i.current_stock_level), 0::bigint) AS current_stock_level,
            sum(
                CASE
                    WHEN i.expiration_date <= (CURRENT_DATE + '30 days'::interval) AND COALESCE(i.current_stock_level, 0) > 0 THEN 1
                    ELSE 0
                END) AS expiration_soon_count
           FROM inventory i
          WHERE COALESCE(i.is_deleted, false) = false
          GROUP BY i.vaccine_id
        )
 SELECT vm.vaccine_id,
    vm.antigen_name,
    vm.brand_name,
    vm.category,
    COALESCE(inv.current_stock_level, 0::bigint) AS current_stock_level,
    COALESCE(inv.expiration_soon_count, 0::bigint) AS expiration_soon_count,
    10 AS minimum_threshold
   FROM vaccinemaster vm
     LEFT JOIN inv ON inv.vaccine_id = vm.vaccine_id
  WHERE COALESCE(vm.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public | inventorylowstock_view   | 4               | category                             | USER-DEFINED                |  WITH inv AS (
         SELECT i.vaccine_id,
            COALESCE(sum(i.current_stock_level), 0::bigint) AS current_stock_level,
            sum(
                CASE
                    WHEN i.expiration_date <= (CURRENT_DATE + '30 days'::interval) AND COALESCE(i.current_stock_level, 0) > 0 THEN 1
                    ELSE 0
                END) AS expiration_soon_count
           FROM inventory i
          WHERE COALESCE(i.is_deleted, false) = false
          GROUP BY i.vaccine_id
        )
 SELECT vm.vaccine_id,
    vm.antigen_name,
    vm.brand_name,
    vm.category,
    COALESCE(inv.current_stock_level, 0::bigint) AS current_stock_level,
    COALESCE(inv.expiration_soon_count, 0::bigint) AS expiration_soon_count,
    10 AS minimum_threshold
   FROM vaccinemaster vm
     LEFT JOIN inv ON inv.vaccine_id = vm.vaccine_id
  WHERE COALESCE(vm.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public | inventorylowstock_view   | 5               | current_stock_level                  | bigint                      |  WITH inv AS (
         SELECT i.vaccine_id,
            COALESCE(sum(i.current_stock_level), 0::bigint) AS current_stock_level,
            sum(
                CASE
                    WHEN i.expiration_date <= (CURRENT_DATE + '30 days'::interval) AND COALESCE(i.current_stock_level, 0) > 0 THEN 1
                    ELSE 0
                END) AS expiration_soon_count
           FROM inventory i
          WHERE COALESCE(i.is_deleted, false) = false
          GROUP BY i.vaccine_id
        )
 SELECT vm.vaccine_id,
    vm.antigen_name,
    vm.brand_name,
    vm.category,
    COALESCE(inv.current_stock_level, 0::bigint) AS current_stock_level,
    COALESCE(inv.expiration_soon_count, 0::bigint) AS expiration_soon_count,
    10 AS minimum_threshold
   FROM vaccinemaster vm
     LEFT JOIN inv ON inv.vaccine_id = vm.vaccine_id
  WHERE COALESCE(vm.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public | inventorylowstock_view   | 6               | expiration_soon_count                | bigint                      |  WITH inv AS (
         SELECT i.vaccine_id,
            COALESCE(sum(i.current_stock_level), 0::bigint) AS current_stock_level,
            sum(
                CASE
                    WHEN i.expiration_date <= (CURRENT_DATE + '30 days'::interval) AND COALESCE(i.current_stock_level, 0) > 0 THEN 1
                    ELSE 0
                END) AS expiration_soon_count
           FROM inventory i
          WHERE COALESCE(i.is_deleted, false) = false
          GROUP BY i.vaccine_id
        )
 SELECT vm.vaccine_id,
    vm.antigen_name,
    vm.brand_name,
    vm.category,
    COALESCE(inv.current_stock_level, 0::bigint) AS current_stock_level,
    COALESCE(inv.expiration_soon_count, 0::bigint) AS expiration_soon_count,
    10 AS minimum_threshold
   FROM vaccinemaster vm
     LEFT JOIN inv ON inv.vaccine_id = vm.vaccine_id
  WHERE COALESCE(vm.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public | inventorylowstock_view   | 7               | minimum_threshold                    | integer                     |  WITH inv AS (
         SELECT i.vaccine_id,
            COALESCE(sum(i.current_stock_level), 0::bigint) AS current_stock_level,
            sum(
                CASE
                    WHEN i.expiration_date <= (CURRENT_DATE + '30 days'::interval) AND COALESCE(i.current_stock_level, 0) > 0 THEN 1
                    ELSE 0
                END) AS expiration_soon_count
           FROM inventory i
          WHERE COALESCE(i.is_deleted, false) = false
          GROUP BY i.vaccine_id
        )
 SELECT vm.vaccine_id,
    vm.antigen_name,
    vm.brand_name,
    vm.category,
    COALESCE(inv.current_stock_level, 0::bigint) AS current_stock_level,
    COALESCE(inv.expiration_soon_count, 0::bigint) AS expiration_soon_count,
    10 AS minimum_threshold
   FROM vaccinemaster vm
     LEFT JOIN inv ON inv.vaccine_id = vm.vaccine_id
  WHERE COALESCE(vm.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public | monthlyreports_view      | 1               | report_month                         | text                        |  WITH im AS (
         SELECT im.immunization_id,
            im.vaccine_id,
            im.dose_number,
            COALESCE(im.administered_date, v.visit_date) AS administered_on,
            p.sex
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
          WHERE COALESCE(im.is_deleted, false) = false
        ), im_month AS (
         SELECT to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS total_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Male'::text) AS male_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Female'::text) AS female_vaccinated
           FROM immunizations im2
             LEFT JOIN visits v2 ON v2.visit_id = im2.visit_id
             JOIN patients p ON p.patient_id = v2.patient_id
          WHERE COALESCE(im2.is_deleted, false) = false
          GROUP BY (to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text))
        ), vitamina_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS vitamina_given
           FROM vitamina vt
             JOIN visits v ON v.visit_id = vt.visit_id
          WHERE COALESCE(vt.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), deworming_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS deworming_given
           FROM deworming d
             JOIN visits v ON v.visit_id = d.visit_id
          WHERE COALESCE(d.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), usage_antigen AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.antigen_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.antigen_name
        ), usage_brand AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.brand_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.brand_name
        ), usage_category AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.category,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.category
        )
 SELECT m.report_month,
    COALESCE(m.count, 0::bigint) AS total_patients_seen,
    COALESCE(im_month.male_vaccinated, 0::bigint) AS male_vaccinated,
    COALESCE(im_month.female_vaccinated, 0::bigint) AS female_vaccinated,
    COALESCE(im_month.total_vaccinated, 0::bigint) AS total_vaccinated,
    COALESCE(vm.vitamina_given, 0::bigint) AS vitamina_given,
    COALESCE(dw.deworming_given, 0::bigint) AS deworming_given,
    ( SELECT jsonb_object_agg(ua.antigen_name, ua.used) AS jsonb_object_agg
           FROM usage_antigen ua
          WHERE ua.report_month = m.report_month) AS vaccines_used_by_antigen,
    ( SELECT jsonb_object_agg(ub.brand_name, ub.used) AS jsonb_object_agg
           FROM usage_brand ub
          WHERE ub.report_month = m.report_month) AS vaccines_used_by_brand,
    ( SELECT jsonb_object_agg(uc.category::text, uc.used) AS jsonb_object_agg
           FROM usage_category uc
          WHERE uc.report_month = m.report_month) AS vaccines_used_by_category
   FROM ( SELECT to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS count
           FROM visits
          GROUP BY (to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text))) m
     LEFT JOIN im_month ON im_month.report_month = m.report_month
     LEFT JOIN vitamina_month vm ON vm.report_month = m.report_month
     LEFT JOIN deworming_month dw ON dw.report_month = m.report_month; |
| public | monthlyreports_view      | 2               | total_patients_seen                  | bigint                      |  WITH im AS (
         SELECT im.immunization_id,
            im.vaccine_id,
            im.dose_number,
            COALESCE(im.administered_date, v.visit_date) AS administered_on,
            p.sex
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
          WHERE COALESCE(im.is_deleted, false) = false
        ), im_month AS (
         SELECT to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS total_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Male'::text) AS male_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Female'::text) AS female_vaccinated
           FROM immunizations im2
             LEFT JOIN visits v2 ON v2.visit_id = im2.visit_id
             JOIN patients p ON p.patient_id = v2.patient_id
          WHERE COALESCE(im2.is_deleted, false) = false
          GROUP BY (to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text))
        ), vitamina_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS vitamina_given
           FROM vitamina vt
             JOIN visits v ON v.visit_id = vt.visit_id
          WHERE COALESCE(vt.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), deworming_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS deworming_given
           FROM deworming d
             JOIN visits v ON v.visit_id = d.visit_id
          WHERE COALESCE(d.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), usage_antigen AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.antigen_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.antigen_name
        ), usage_brand AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.brand_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.brand_name
        ), usage_category AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.category,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.category
        )
 SELECT m.report_month,
    COALESCE(m.count, 0::bigint) AS total_patients_seen,
    COALESCE(im_month.male_vaccinated, 0::bigint) AS male_vaccinated,
    COALESCE(im_month.female_vaccinated, 0::bigint) AS female_vaccinated,
    COALESCE(im_month.total_vaccinated, 0::bigint) AS total_vaccinated,
    COALESCE(vm.vitamina_given, 0::bigint) AS vitamina_given,
    COALESCE(dw.deworming_given, 0::bigint) AS deworming_given,
    ( SELECT jsonb_object_agg(ua.antigen_name, ua.used) AS jsonb_object_agg
           FROM usage_antigen ua
          WHERE ua.report_month = m.report_month) AS vaccines_used_by_antigen,
    ( SELECT jsonb_object_agg(ub.brand_name, ub.used) AS jsonb_object_agg
           FROM usage_brand ub
          WHERE ub.report_month = m.report_month) AS vaccines_used_by_brand,
    ( SELECT jsonb_object_agg(uc.category::text, uc.used) AS jsonb_object_agg
           FROM usage_category uc
          WHERE uc.report_month = m.report_month) AS vaccines_used_by_category
   FROM ( SELECT to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS count
           FROM visits
          GROUP BY (to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text))) m
     LEFT JOIN im_month ON im_month.report_month = m.report_month
     LEFT JOIN vitamina_month vm ON vm.report_month = m.report_month
     LEFT JOIN deworming_month dw ON dw.report_month = m.report_month; |
| public | monthlyreports_view      | 3               | male_vaccinated                      | bigint                      |  WITH im AS (
         SELECT im.immunization_id,
            im.vaccine_id,
            im.dose_number,
            COALESCE(im.administered_date, v.visit_date) AS administered_on,
            p.sex
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
          WHERE COALESCE(im.is_deleted, false) = false
        ), im_month AS (
         SELECT to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS total_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Male'::text) AS male_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Female'::text) AS female_vaccinated
           FROM immunizations im2
             LEFT JOIN visits v2 ON v2.visit_id = im2.visit_id
             JOIN patients p ON p.patient_id = v2.patient_id
          WHERE COALESCE(im2.is_deleted, false) = false
          GROUP BY (to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text))
        ), vitamina_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS vitamina_given
           FROM vitamina vt
             JOIN visits v ON v.visit_id = vt.visit_id
          WHERE COALESCE(vt.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), deworming_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS deworming_given
           FROM deworming d
             JOIN visits v ON v.visit_id = d.visit_id
          WHERE COALESCE(d.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), usage_antigen AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.antigen_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.antigen_name
        ), usage_brand AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.brand_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.brand_name
        ), usage_category AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.category,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.category
        )
 SELECT m.report_month,
    COALESCE(m.count, 0::bigint) AS total_patients_seen,
    COALESCE(im_month.male_vaccinated, 0::bigint) AS male_vaccinated,
    COALESCE(im_month.female_vaccinated, 0::bigint) AS female_vaccinated,
    COALESCE(im_month.total_vaccinated, 0::bigint) AS total_vaccinated,
    COALESCE(vm.vitamina_given, 0::bigint) AS vitamina_given,
    COALESCE(dw.deworming_given, 0::bigint) AS deworming_given,
    ( SELECT jsonb_object_agg(ua.antigen_name, ua.used) AS jsonb_object_agg
           FROM usage_antigen ua
          WHERE ua.report_month = m.report_month) AS vaccines_used_by_antigen,
    ( SELECT jsonb_object_agg(ub.brand_name, ub.used) AS jsonb_object_agg
           FROM usage_brand ub
          WHERE ub.report_month = m.report_month) AS vaccines_used_by_brand,
    ( SELECT jsonb_object_agg(uc.category::text, uc.used) AS jsonb_object_agg
           FROM usage_category uc
          WHERE uc.report_month = m.report_month) AS vaccines_used_by_category
   FROM ( SELECT to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS count
           FROM visits
          GROUP BY (to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text))) m
     LEFT JOIN im_month ON im_month.report_month = m.report_month
     LEFT JOIN vitamina_month vm ON vm.report_month = m.report_month
     LEFT JOIN deworming_month dw ON dw.report_month = m.report_month; |
| public | monthlyreports_view      | 4               | female_vaccinated                    | bigint                      |  WITH im AS (
         SELECT im.immunization_id,
            im.vaccine_id,
            im.dose_number,
            COALESCE(im.administered_date, v.visit_date) AS administered_on,
            p.sex
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
          WHERE COALESCE(im.is_deleted, false) = false
        ), im_month AS (
         SELECT to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS total_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Male'::text) AS male_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Female'::text) AS female_vaccinated
           FROM immunizations im2
             LEFT JOIN visits v2 ON v2.visit_id = im2.visit_id
             JOIN patients p ON p.patient_id = v2.patient_id
          WHERE COALESCE(im2.is_deleted, false) = false
          GROUP BY (to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text))
        ), vitamina_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS vitamina_given
           FROM vitamina vt
             JOIN visits v ON v.visit_id = vt.visit_id
          WHERE COALESCE(vt.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), deworming_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS deworming_given
           FROM deworming d
             JOIN visits v ON v.visit_id = d.visit_id
          WHERE COALESCE(d.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), usage_antigen AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.antigen_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.antigen_name
        ), usage_brand AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.brand_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.brand_name
        ), usage_category AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.category,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.category
        )
 SELECT m.report_month,
    COALESCE(m.count, 0::bigint) AS total_patients_seen,
    COALESCE(im_month.male_vaccinated, 0::bigint) AS male_vaccinated,
    COALESCE(im_month.female_vaccinated, 0::bigint) AS female_vaccinated,
    COALESCE(im_month.total_vaccinated, 0::bigint) AS total_vaccinated,
    COALESCE(vm.vitamina_given, 0::bigint) AS vitamina_given,
    COALESCE(dw.deworming_given, 0::bigint) AS deworming_given,
    ( SELECT jsonb_object_agg(ua.antigen_name, ua.used) AS jsonb_object_agg
           FROM usage_antigen ua
          WHERE ua.report_month = m.report_month) AS vaccines_used_by_antigen,
    ( SELECT jsonb_object_agg(ub.brand_name, ub.used) AS jsonb_object_agg
           FROM usage_brand ub
          WHERE ub.report_month = m.report_month) AS vaccines_used_by_brand,
    ( SELECT jsonb_object_agg(uc.category::text, uc.used) AS jsonb_object_agg
           FROM usage_category uc
          WHERE uc.report_month = m.report_month) AS vaccines_used_by_category
   FROM ( SELECT to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS count
           FROM visits
          GROUP BY (to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text))) m
     LEFT JOIN im_month ON im_month.report_month = m.report_month
     LEFT JOIN vitamina_month vm ON vm.report_month = m.report_month
     LEFT JOIN deworming_month dw ON dw.report_month = m.report_month; |
| public | monthlyreports_view      | 5               | total_vaccinated                     | bigint                      |  WITH im AS (
         SELECT im.immunization_id,
            im.vaccine_id,
            im.dose_number,
            COALESCE(im.administered_date, v.visit_date) AS administered_on,
            p.sex
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
          WHERE COALESCE(im.is_deleted, false) = false
        ), im_month AS (
         SELECT to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS total_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Male'::text) AS male_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Female'::text) AS female_vaccinated
           FROM immunizations im2
             LEFT JOIN visits v2 ON v2.visit_id = im2.visit_id
             JOIN patients p ON p.patient_id = v2.patient_id
          WHERE COALESCE(im2.is_deleted, false) = false
          GROUP BY (to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text))
        ), vitamina_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS vitamina_given
           FROM vitamina vt
             JOIN visits v ON v.visit_id = vt.visit_id
          WHERE COALESCE(vt.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), deworming_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS deworming_given
           FROM deworming d
             JOIN visits v ON v.visit_id = d.visit_id
          WHERE COALESCE(d.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), usage_antigen AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.antigen_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.antigen_name
        ), usage_brand AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.brand_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.brand_name
        ), usage_category AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.category,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.category
        )
 SELECT m.report_month,
    COALESCE(m.count, 0::bigint) AS total_patients_seen,
    COALESCE(im_month.male_vaccinated, 0::bigint) AS male_vaccinated,
    COALESCE(im_month.female_vaccinated, 0::bigint) AS female_vaccinated,
    COALESCE(im_month.total_vaccinated, 0::bigint) AS total_vaccinated,
    COALESCE(vm.vitamina_given, 0::bigint) AS vitamina_given,
    COALESCE(dw.deworming_given, 0::bigint) AS deworming_given,
    ( SELECT jsonb_object_agg(ua.antigen_name, ua.used) AS jsonb_object_agg
           FROM usage_antigen ua
          WHERE ua.report_month = m.report_month) AS vaccines_used_by_antigen,
    ( SELECT jsonb_object_agg(ub.brand_name, ub.used) AS jsonb_object_agg
           FROM usage_brand ub
          WHERE ub.report_month = m.report_month) AS vaccines_used_by_brand,
    ( SELECT jsonb_object_agg(uc.category::text, uc.used) AS jsonb_object_agg
           FROM usage_category uc
          WHERE uc.report_month = m.report_month) AS vaccines_used_by_category
   FROM ( SELECT to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS count
           FROM visits
          GROUP BY (to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text))) m
     LEFT JOIN im_month ON im_month.report_month = m.report_month
     LEFT JOIN vitamina_month vm ON vm.report_month = m.report_month
     LEFT JOIN deworming_month dw ON dw.report_month = m.report_month; |
| public | monthlyreports_view      | 6               | vitamina_given                       | bigint                      |  WITH im AS (
         SELECT im.immunization_id,
            im.vaccine_id,
            im.dose_number,
            COALESCE(im.administered_date, v.visit_date) AS administered_on,
            p.sex
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
          WHERE COALESCE(im.is_deleted, false) = false
        ), im_month AS (
         SELECT to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS total_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Male'::text) AS male_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Female'::text) AS female_vaccinated
           FROM immunizations im2
             LEFT JOIN visits v2 ON v2.visit_id = im2.visit_id
             JOIN patients p ON p.patient_id = v2.patient_id
          WHERE COALESCE(im2.is_deleted, false) = false
          GROUP BY (to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text))
        ), vitamina_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS vitamina_given
           FROM vitamina vt
             JOIN visits v ON v.visit_id = vt.visit_id
          WHERE COALESCE(vt.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), deworming_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS deworming_given
           FROM deworming d
             JOIN visits v ON v.visit_id = d.visit_id
          WHERE COALESCE(d.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), usage_antigen AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.antigen_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.antigen_name
        ), usage_brand AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.brand_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.brand_name
        ), usage_category AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.category,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.category
        )
 SELECT m.report_month,
    COALESCE(m.count, 0::bigint) AS total_patients_seen,
    COALESCE(im_month.male_vaccinated, 0::bigint) AS male_vaccinated,
    COALESCE(im_month.female_vaccinated, 0::bigint) AS female_vaccinated,
    COALESCE(im_month.total_vaccinated, 0::bigint) AS total_vaccinated,
    COALESCE(vm.vitamina_given, 0::bigint) AS vitamina_given,
    COALESCE(dw.deworming_given, 0::bigint) AS deworming_given,
    ( SELECT jsonb_object_agg(ua.antigen_name, ua.used) AS jsonb_object_agg
           FROM usage_antigen ua
          WHERE ua.report_month = m.report_month) AS vaccines_used_by_antigen,
    ( SELECT jsonb_object_agg(ub.brand_name, ub.used) AS jsonb_object_agg
           FROM usage_brand ub
          WHERE ub.report_month = m.report_month) AS vaccines_used_by_brand,
    ( SELECT jsonb_object_agg(uc.category::text, uc.used) AS jsonb_object_agg
           FROM usage_category uc
          WHERE uc.report_month = m.report_month) AS vaccines_used_by_category
   FROM ( SELECT to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS count
           FROM visits
          GROUP BY (to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text))) m
     LEFT JOIN im_month ON im_month.report_month = m.report_month
     LEFT JOIN vitamina_month vm ON vm.report_month = m.report_month
     LEFT JOIN deworming_month dw ON dw.report_month = m.report_month; |
| public | monthlyreports_view      | 7               | deworming_given                      | bigint                      |  WITH im AS (
         SELECT im.immunization_id,
            im.vaccine_id,
            im.dose_number,
            COALESCE(im.administered_date, v.visit_date) AS administered_on,
            p.sex
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
          WHERE COALESCE(im.is_deleted, false) = false
        ), im_month AS (
         SELECT to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS total_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Male'::text) AS male_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Female'::text) AS female_vaccinated
           FROM immunizations im2
             LEFT JOIN visits v2 ON v2.visit_id = im2.visit_id
             JOIN patients p ON p.patient_id = v2.patient_id
          WHERE COALESCE(im2.is_deleted, false) = false
          GROUP BY (to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text))
        ), vitamina_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS vitamina_given
           FROM vitamina vt
             JOIN visits v ON v.visit_id = vt.visit_id
          WHERE COALESCE(vt.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), deworming_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS deworming_given
           FROM deworming d
             JOIN visits v ON v.visit_id = d.visit_id
          WHERE COALESCE(d.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), usage_antigen AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.antigen_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.antigen_name
        ), usage_brand AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.brand_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.brand_name
        ), usage_category AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.category,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.category
        )
 SELECT m.report_month,
    COALESCE(m.count, 0::bigint) AS total_patients_seen,
    COALESCE(im_month.male_vaccinated, 0::bigint) AS male_vaccinated,
    COALESCE(im_month.female_vaccinated, 0::bigint) AS female_vaccinated,
    COALESCE(im_month.total_vaccinated, 0::bigint) AS total_vaccinated,
    COALESCE(vm.vitamina_given, 0::bigint) AS vitamina_given,
    COALESCE(dw.deworming_given, 0::bigint) AS deworming_given,
    ( SELECT jsonb_object_agg(ua.antigen_name, ua.used) AS jsonb_object_agg
           FROM usage_antigen ua
          WHERE ua.report_month = m.report_month) AS vaccines_used_by_antigen,
    ( SELECT jsonb_object_agg(ub.brand_name, ub.used) AS jsonb_object_agg
           FROM usage_brand ub
          WHERE ub.report_month = m.report_month) AS vaccines_used_by_brand,
    ( SELECT jsonb_object_agg(uc.category::text, uc.used) AS jsonb_object_agg
           FROM usage_category uc
          WHERE uc.report_month = m.report_month) AS vaccines_used_by_category
   FROM ( SELECT to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS count
           FROM visits
          GROUP BY (to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text))) m
     LEFT JOIN im_month ON im_month.report_month = m.report_month
     LEFT JOIN vitamina_month vm ON vm.report_month = m.report_month
     LEFT JOIN deworming_month dw ON dw.report_month = m.report_month; |
| public | monthlyreports_view      | 8               | vaccines_used_by_antigen             | jsonb                       |  WITH im AS (
         SELECT im.immunization_id,
            im.vaccine_id,
            im.dose_number,
            COALESCE(im.administered_date, v.visit_date) AS administered_on,
            p.sex
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
          WHERE COALESCE(im.is_deleted, false) = false
        ), im_month AS (
         SELECT to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS total_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Male'::text) AS male_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Female'::text) AS female_vaccinated
           FROM immunizations im2
             LEFT JOIN visits v2 ON v2.visit_id = im2.visit_id
             JOIN patients p ON p.patient_id = v2.patient_id
          WHERE COALESCE(im2.is_deleted, false) = false
          GROUP BY (to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text))
        ), vitamina_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS vitamina_given
           FROM vitamina vt
             JOIN visits v ON v.visit_id = vt.visit_id
          WHERE COALESCE(vt.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), deworming_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS deworming_given
           FROM deworming d
             JOIN visits v ON v.visit_id = d.visit_id
          WHERE COALESCE(d.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), usage_antigen AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.antigen_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.antigen_name
        ), usage_brand AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.brand_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.brand_name
        ), usage_category AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.category,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.category
        )
 SELECT m.report_month,
    COALESCE(m.count, 0::bigint) AS total_patients_seen,
    COALESCE(im_month.male_vaccinated, 0::bigint) AS male_vaccinated,
    COALESCE(im_month.female_vaccinated, 0::bigint) AS female_vaccinated,
    COALESCE(im_month.total_vaccinated, 0::bigint) AS total_vaccinated,
    COALESCE(vm.vitamina_given, 0::bigint) AS vitamina_given,
    COALESCE(dw.deworming_given, 0::bigint) AS deworming_given,
    ( SELECT jsonb_object_agg(ua.antigen_name, ua.used) AS jsonb_object_agg
           FROM usage_antigen ua
          WHERE ua.report_month = m.report_month) AS vaccines_used_by_antigen,
    ( SELECT jsonb_object_agg(ub.brand_name, ub.used) AS jsonb_object_agg
           FROM usage_brand ub
          WHERE ub.report_month = m.report_month) AS vaccines_used_by_brand,
    ( SELECT jsonb_object_agg(uc.category::text, uc.used) AS jsonb_object_agg
           FROM usage_category uc
          WHERE uc.report_month = m.report_month) AS vaccines_used_by_category
   FROM ( SELECT to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS count
           FROM visits
          GROUP BY (to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text))) m
     LEFT JOIN im_month ON im_month.report_month = m.report_month
     LEFT JOIN vitamina_month vm ON vm.report_month = m.report_month
     LEFT JOIN deworming_month dw ON dw.report_month = m.report_month; |
| public | monthlyreports_view      | 9               | vaccines_used_by_brand               | jsonb                       |  WITH im AS (
         SELECT im.immunization_id,
            im.vaccine_id,
            im.dose_number,
            COALESCE(im.administered_date, v.visit_date) AS administered_on,
            p.sex
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
          WHERE COALESCE(im.is_deleted, false) = false
        ), im_month AS (
         SELECT to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS total_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Male'::text) AS male_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Female'::text) AS female_vaccinated
           FROM immunizations im2
             LEFT JOIN visits v2 ON v2.visit_id = im2.visit_id
             JOIN patients p ON p.patient_id = v2.patient_id
          WHERE COALESCE(im2.is_deleted, false) = false
          GROUP BY (to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text))
        ), vitamina_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS vitamina_given
           FROM vitamina vt
             JOIN visits v ON v.visit_id = vt.visit_id
          WHERE COALESCE(vt.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), deworming_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS deworming_given
           FROM deworming d
             JOIN visits v ON v.visit_id = d.visit_id
          WHERE COALESCE(d.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), usage_antigen AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.antigen_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.antigen_name
        ), usage_brand AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.brand_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.brand_name
        ), usage_category AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.category,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.category
        )
 SELECT m.report_month,
    COALESCE(m.count, 0::bigint) AS total_patients_seen,
    COALESCE(im_month.male_vaccinated, 0::bigint) AS male_vaccinated,
    COALESCE(im_month.female_vaccinated, 0::bigint) AS female_vaccinated,
    COALESCE(im_month.total_vaccinated, 0::bigint) AS total_vaccinated,
    COALESCE(vm.vitamina_given, 0::bigint) AS vitamina_given,
    COALESCE(dw.deworming_given, 0::bigint) AS deworming_given,
    ( SELECT jsonb_object_agg(ua.antigen_name, ua.used) AS jsonb_object_agg
           FROM usage_antigen ua
          WHERE ua.report_month = m.report_month) AS vaccines_used_by_antigen,
    ( SELECT jsonb_object_agg(ub.brand_name, ub.used) AS jsonb_object_agg
           FROM usage_brand ub
          WHERE ub.report_month = m.report_month) AS vaccines_used_by_brand,
    ( SELECT jsonb_object_agg(uc.category::text, uc.used) AS jsonb_object_agg
           FROM usage_category uc
          WHERE uc.report_month = m.report_month) AS vaccines_used_by_category
   FROM ( SELECT to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS count
           FROM visits
          GROUP BY (to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text))) m
     LEFT JOIN im_month ON im_month.report_month = m.report_month
     LEFT JOIN vitamina_month vm ON vm.report_month = m.report_month
     LEFT JOIN deworming_month dw ON dw.report_month = m.report_month; |
| public | monthlyreports_view      | 10              | vaccines_used_by_category            | jsonb                       |  WITH im AS (
         SELECT im.immunization_id,
            im.vaccine_id,
            im.dose_number,
            COALESCE(im.administered_date, v.visit_date) AS administered_on,
            p.sex
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
          WHERE COALESCE(im.is_deleted, false) = false
        ), im_month AS (
         SELECT to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS total_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Male'::text) AS male_vaccinated,
            count(*) FILTER (WHERE p.sex::text = 'Female'::text) AS female_vaccinated
           FROM immunizations im2
             LEFT JOIN visits v2 ON v2.visit_id = im2.visit_id
             JOIN patients p ON p.patient_id = v2.patient_id
          WHERE COALESCE(im2.is_deleted, false) = false
          GROUP BY (to_char(im2.administered_date::timestamp with time zone, 'YYYY-MM'::text))
        ), vitamina_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS vitamina_given
           FROM vitamina vt
             JOIN visits v ON v.visit_id = vt.visit_id
          WHERE COALESCE(vt.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), deworming_month AS (
         SELECT to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS deworming_given
           FROM deworming d
             JOIN visits v ON v.visit_id = d.visit_id
          WHERE COALESCE(d.is_deleted, false) = false
          GROUP BY (to_char(v.visit_date::timestamp with time zone, 'YYYY-MM'::text))
        ), usage_antigen AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.antigen_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.antigen_name
        ), usage_brand AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.brand_name,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.brand_name
        ), usage_category AS (
         SELECT to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            vm_1.category,
            count(*) AS used
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN vaccinemaster vm_1 ON vm_1.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
          GROUP BY (to_char(COALESCE(im.administered_date, v.visit_date)::timestamp with time zone, 'YYYY-MM'::text)), vm_1.category
        )
 SELECT m.report_month,
    COALESCE(m.count, 0::bigint) AS total_patients_seen,
    COALESCE(im_month.male_vaccinated, 0::bigint) AS male_vaccinated,
    COALESCE(im_month.female_vaccinated, 0::bigint) AS female_vaccinated,
    COALESCE(im_month.total_vaccinated, 0::bigint) AS total_vaccinated,
    COALESCE(vm.vitamina_given, 0::bigint) AS vitamina_given,
    COALESCE(dw.deworming_given, 0::bigint) AS deworming_given,
    ( SELECT jsonb_object_agg(ua.antigen_name, ua.used) AS jsonb_object_agg
           FROM usage_antigen ua
          WHERE ua.report_month = m.report_month) AS vaccines_used_by_antigen,
    ( SELECT jsonb_object_agg(ub.brand_name, ub.used) AS jsonb_object_agg
           FROM usage_brand ub
          WHERE ub.report_month = m.report_month) AS vaccines_used_by_brand,
    ( SELECT jsonb_object_agg(uc.category::text, uc.used) AS jsonb_object_agg
           FROM usage_category uc
          WHERE uc.report_month = m.report_month) AS vaccines_used_by_category
   FROM ( SELECT to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text) AS report_month,
            count(*) AS count
           FROM visits
          GROUP BY (to_char(visits.visit_date::timestamp with time zone, 'YYYY-MM'::text))) m
     LEFT JOIN im_month ON im_month.report_month = m.report_month
     LEFT JOIN vitamina_month vm ON vm.report_month = m.report_month
     LEFT JOIN deworming_month dw ON dw.report_month = m.report_month; |
| public | notifications_view       | 1               | notification_id                      | bigint                      |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 2               | channel                              | character varying           |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 3               | recipient_user_id                    | bigint                      |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 4               | recipient_phone                      | character varying           |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 5               | recipient_email                      | character varying           |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 6               | template_code                        | character varying           |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 7               | message_body                         | text                        |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 8               | related_entity_type                  | character varying           |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 9               | related_entity_id                    | bigint                      |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 10              | scheduled_at                         | timestamp without time zone |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 11              | sent_at                              | timestamp without time zone |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 12              | status                               | character varying           |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 13              | error_message                        | text                        |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 14              | created_by                           | bigint                      |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 15              | created_at                           | timestamp without time zone |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 16              | is_deleted                           | boolean                     |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 17              | deleted_at                           | timestamp without time zone |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 18              | deleted_by                           | bigint                      |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 19              | updated_at                           | timestamp with time zone    |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 20              | updated_by                           | bigint                      |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 21              | read_at                              | timestamp with time zone    |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | notifications_view       | 22              | recipient_name                       | text                        |  SELECT n.notification_id,
    n.channel,
    n.recipient_user_id,
    n.recipient_phone,
    n.recipient_email,
    n.template_code,
    n.message_body,
    n.related_entity_type,
    n.related_entity_id,
    n.scheduled_at,
    n.sent_at,
    n.status,
    n.error_message,
    n.created_by,
    n.created_at,
    n.is_deleted,
    n.deleted_at,
    n.deleted_by,
    n.updated_at,
    n.updated_by,
    n.read_at,
    concat(u.firstname, ' ', u.surname) AS recipient_name
   FROM notifications n
     LEFT JOIN users u ON n.recipient_user_id = u.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public | patients_view            | 1               | patient_id                           | bigint                      |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 2               | surname                              | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 3               | firstname                            | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 4               | middlename                           | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 5               | sex                                  | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 6               | date_of_birth                        | date                        |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 7               | address                              | text                        |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 8               | barangay                             | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 9               | health_center                        | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 10              | date_registered                      | timestamp with time zone    |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 11              | mother_name                          | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 12              | mother_occupation                    | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 13              | mother_contact_number                | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 14              | father_name                          | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 15              | father_occupation                    | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 16              | father_contact_number                | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 17              | guardian_id                          | bigint                      |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 18              | guardian_surname                     | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 19              | guardian_firstname                   | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 20              | guardian_middlename                  | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 21              | guardian_birthdate                   | date                        |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 22              | guardian_address                     | text                        |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 23              | guardian_occupation                  | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 24              | guardian_contact_number              | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 25              | guardian_alternative_contact_number  | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 26              | guardian_email                       | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 27              | relationship_to_guardian             | text                        |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 28              | guardian_family_number               | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 29              | guardian_date_registered             | timestamp with time zone    |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 30              | guardian_user_id                     | bigint                      |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 31              | tags                                 | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 32              | is_deleted                           | boolean                     |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 33              | deleted_at                           | timestamp without time zone |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 34              | deleted_by                           | bigint                      |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 35              | created_at                           | timestamp with time zone    |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 36              | created_by                           | bigint                      |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 37              | updated_at                           | timestamp with time zone    |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 38              | updated_by                           | bigint                      |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 39              | full_name                            | text                        |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 40              | last_vaccination_date                | timestamp with time zone    |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 41              | birthhistory_id                      | bigint                      |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 42              | birth_weight                         | numeric                     |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 43              | birth_length                         | numeric                     |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 44              | place_of_birth                       | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 45              | address_at_birth                     | text                        |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 46              | time_of_birth                        | time without time zone      |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 47              | attendant_at_birth                   | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 48              | type_of_delivery                     | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 49              | ballards_score                       | integer                     |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 50              | hearing_test_date                    | date                        |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 51              | newborn_screening_date               | date                        |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patients_view            | 52              | newborn_screening_result             | character varying           |  SELECT p.patient_id,
    p.surname,
    p.firstname,
    p.middlename,
    p.sex,
    p.date_of_birth,
    p.address,
    p.barangay,
    p.health_center,
    timezone('Asia/Manila'::text, p.date_registered) AS date_registered,
    p.mother_name,
    p.mother_occupation,
    p.mother_contact_number,
    p.father_name,
    p.father_occupation,
    p.father_contact_number,
    p.guardian_id,
    g.surname AS guardian_surname,
    g.firstname AS guardian_firstname,
    g.middlename AS guardian_middlename,
    g.birthdate AS guardian_birthdate,
    g.address AS guardian_address,
    g.occupation AS guardian_occupation,
    g.contact_number AS guardian_contact_number,
    g.alternative_contact_number AS guardian_alternative_contact_number,
    g.email AS guardian_email,
    p.relationship_to_guardian,
    g.family_number AS guardian_family_number,
    timezone('Asia/Manila'::text, g.date_registered) AS guardian_date_registered,
    g.user_id AS guardian_user_id,
    p.tags,
    p.is_deleted,
    timezone('Asia/Manila'::text, p.deleted_at::timestamp with time zone) AS deleted_at,
    p.deleted_by,
    timezone('Asia/Manila'::text, p.created_at::timestamp without time zone) AS created_at,
    p.created_by,
    timezone('Asia/Manila'::text, p.updated_at::timestamp without time zone) AS updated_at,
    p.updated_by,
    p.full_name,
    ( SELECT timezone('Asia/Manila'::text, max(COALESCE(im.administered_date, v.visit_date))::timestamp without time zone) AS timezone
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
          WHERE COALESCE(im.is_deleted, false) = false AND COALESCE(im.patient_id, v.patient_id) = p.patient_id) AS last_vaccination_date,
    b.birthhistory_id,
    b.birth_weight,
    b.birth_length,
    b.place_of_birth,
    b.address_at_birth,
    b.time_of_birth,
    b.attendant_at_birth,
    b.type_of_delivery,
    b.ballards_score,
    b.hearing_test_date,
    b.newborn_screening_date,
    b.newborn_screening_result
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN birthhistory b ON b.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | patientschedule_view     | 1               | patient_schedule_id                  | bigint                      |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | patientschedule_view     | 2               | patient_id                           | bigint                      |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | patientschedule_view     | 3               | patient_name                         | text                        |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | patientschedule_view     | 4               | vaccine_id                           | bigint                      |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | patientschedule_view     | 5               | antigen_name                         | character varying           |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | patientschedule_view     | 6               | category                             | USER-DEFINED                |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | patientschedule_view     | 7               | dose_number                          | integer                     |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | patientschedule_view     | 8               | scheduled_date                       | date                        |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | patientschedule_view     | 9               | eligible_date                        | date                        |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | patientschedule_view     | 10              | actual_date                          | date                        |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | patientschedule_view     | 11              | status                               | character varying           |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | patientschedule_view     | 12              | days_overdue                         | integer                     |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | patientschedule_view     | 13              | created_at                           | timestamp with time zone    |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | patientschedule_view     | 14              | updated_at                           | timestamp without time zone |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | patientschedule_view     | 15              | created_by                           | bigint                      |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | patientschedule_view     | 16              | updated_by                           | bigint                      |  SELECT s.patient_schedule_id,
    s.patient_id,
    p.full_name AS patient_name,
    s.vaccine_id,
    vm.antigen_name,
    vm.category,
    s.dose_number,
    s.scheduled_date,
    s.eligible_date,
    s.actual_date,
    s.status,
        CASE
            WHEN s.actual_date IS NULL AND s.scheduled_date < CURRENT_DATE THEN GREATEST(CURRENT_DATE - s.scheduled_date, 0)
            ELSE 0
        END AS days_overdue,
    s.created_at,
    s.updated_at,
    s.created_by,
    s.updated_by
   FROM patientschedule s
     JOIN patients p ON p.patient_id = s.patient_id
     JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
  WHERE COALESCE(s.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public | tcl_view                 | 1               | patient_id                           | bigint                      |  WITH latest_visit AS (
         SELECT v.patient_id,
            max(v.visit_date) AS latest_visit_date
           FROM visits v
          GROUP BY v.patient_id
        ), imm_status AS (
         SELECT s.patient_id,
            jsonb_agg(jsonb_build_object('antigen', vm.antigen_name, 'dose', s.dose_number, 'status', s.status, 'scheduled_date', s.scheduled_date, 'actual_date', s.actual_date) ORDER BY vm.antigen_name, s.dose_number) AS immunization_status
           FROM patientschedule s
             JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
          WHERE COALESCE(s.is_deleted, false) = false
          GROUP BY s.patient_id
        ), vit_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(vt.vitamina_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS vitamina_status
           FROM visits v
             LEFT JOIN vitamina vt ON vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false
          GROUP BY v.patient_id
        ), dew_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(d.deworming_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS deworming_status
           FROM visits v
             LEFT JOIN deworming d ON d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false
          GROUP BY v.patient_id
        )
 SELECT p.patient_id,
    p.full_name AS patient_name,
    p.sex,
    p.date_of_birth,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (30 * 24 * 60 * 60)::double precision AS age_months,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (24 * 60 * 60)::double precision AS age_days,
    p.barangay,
    p.health_center,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number AS guardian_contact,
    lv.latest_visit_date,
    COALESCE(isx.immunization_status, '[]'::jsonb) AS immunization_status,
    COALESCE(vsx.vitamina_status, 'No'::text) AS vitamina_status,
    COALESCE(dsx.deworming_status, 'No'::text) AS deworming_status,
    p.tags
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN latest_visit lv ON lv.patient_id = p.patient_id
     LEFT JOIN imm_status isx ON isx.patient_id = p.patient_id
     LEFT JOIN vit_status vsx ON vsx.patient_id = p.patient_id
     LEFT JOIN dew_status dsx ON dsx.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | tcl_view                 | 2               | patient_name                         | text                        |  WITH latest_visit AS (
         SELECT v.patient_id,
            max(v.visit_date) AS latest_visit_date
           FROM visits v
          GROUP BY v.patient_id
        ), imm_status AS (
         SELECT s.patient_id,
            jsonb_agg(jsonb_build_object('antigen', vm.antigen_name, 'dose', s.dose_number, 'status', s.status, 'scheduled_date', s.scheduled_date, 'actual_date', s.actual_date) ORDER BY vm.antigen_name, s.dose_number) AS immunization_status
           FROM patientschedule s
             JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
          WHERE COALESCE(s.is_deleted, false) = false
          GROUP BY s.patient_id
        ), vit_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(vt.vitamina_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS vitamina_status
           FROM visits v
             LEFT JOIN vitamina vt ON vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false
          GROUP BY v.patient_id
        ), dew_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(d.deworming_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS deworming_status
           FROM visits v
             LEFT JOIN deworming d ON d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false
          GROUP BY v.patient_id
        )
 SELECT p.patient_id,
    p.full_name AS patient_name,
    p.sex,
    p.date_of_birth,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (30 * 24 * 60 * 60)::double precision AS age_months,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (24 * 60 * 60)::double precision AS age_days,
    p.barangay,
    p.health_center,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number AS guardian_contact,
    lv.latest_visit_date,
    COALESCE(isx.immunization_status, '[]'::jsonb) AS immunization_status,
    COALESCE(vsx.vitamina_status, 'No'::text) AS vitamina_status,
    COALESCE(dsx.deworming_status, 'No'::text) AS deworming_status,
    p.tags
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN latest_visit lv ON lv.patient_id = p.patient_id
     LEFT JOIN imm_status isx ON isx.patient_id = p.patient_id
     LEFT JOIN vit_status vsx ON vsx.patient_id = p.patient_id
     LEFT JOIN dew_status dsx ON dsx.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | tcl_view                 | 3               | sex                                  | character varying           |  WITH latest_visit AS (
         SELECT v.patient_id,
            max(v.visit_date) AS latest_visit_date
           FROM visits v
          GROUP BY v.patient_id
        ), imm_status AS (
         SELECT s.patient_id,
            jsonb_agg(jsonb_build_object('antigen', vm.antigen_name, 'dose', s.dose_number, 'status', s.status, 'scheduled_date', s.scheduled_date, 'actual_date', s.actual_date) ORDER BY vm.antigen_name, s.dose_number) AS immunization_status
           FROM patientschedule s
             JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
          WHERE COALESCE(s.is_deleted, false) = false
          GROUP BY s.patient_id
        ), vit_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(vt.vitamina_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS vitamina_status
           FROM visits v
             LEFT JOIN vitamina vt ON vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false
          GROUP BY v.patient_id
        ), dew_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(d.deworming_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS deworming_status
           FROM visits v
             LEFT JOIN deworming d ON d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false
          GROUP BY v.patient_id
        )
 SELECT p.patient_id,
    p.full_name AS patient_name,
    p.sex,
    p.date_of_birth,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (30 * 24 * 60 * 60)::double precision AS age_months,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (24 * 60 * 60)::double precision AS age_days,
    p.barangay,
    p.health_center,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number AS guardian_contact,
    lv.latest_visit_date,
    COALESCE(isx.immunization_status, '[]'::jsonb) AS immunization_status,
    COALESCE(vsx.vitamina_status, 'No'::text) AS vitamina_status,
    COALESCE(dsx.deworming_status, 'No'::text) AS deworming_status,
    p.tags
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN latest_visit lv ON lv.patient_id = p.patient_id
     LEFT JOIN imm_status isx ON isx.patient_id = p.patient_id
     LEFT JOIN vit_status vsx ON vsx.patient_id = p.patient_id
     LEFT JOIN dew_status dsx ON dsx.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | tcl_view                 | 4               | date_of_birth                        | date                        |  WITH latest_visit AS (
         SELECT v.patient_id,
            max(v.visit_date) AS latest_visit_date
           FROM visits v
          GROUP BY v.patient_id
        ), imm_status AS (
         SELECT s.patient_id,
            jsonb_agg(jsonb_build_object('antigen', vm.antigen_name, 'dose', s.dose_number, 'status', s.status, 'scheduled_date', s.scheduled_date, 'actual_date', s.actual_date) ORDER BY vm.antigen_name, s.dose_number) AS immunization_status
           FROM patientschedule s
             JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
          WHERE COALESCE(s.is_deleted, false) = false
          GROUP BY s.patient_id
        ), vit_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(vt.vitamina_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS vitamina_status
           FROM visits v
             LEFT JOIN vitamina vt ON vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false
          GROUP BY v.patient_id
        ), dew_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(d.deworming_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS deworming_status
           FROM visits v
             LEFT JOIN deworming d ON d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false
          GROUP BY v.patient_id
        )
 SELECT p.patient_id,
    p.full_name AS patient_name,
    p.sex,
    p.date_of_birth,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (30 * 24 * 60 * 60)::double precision AS age_months,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (24 * 60 * 60)::double precision AS age_days,
    p.barangay,
    p.health_center,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number AS guardian_contact,
    lv.latest_visit_date,
    COALESCE(isx.immunization_status, '[]'::jsonb) AS immunization_status,
    COALESCE(vsx.vitamina_status, 'No'::text) AS vitamina_status,
    COALESCE(dsx.deworming_status, 'No'::text) AS deworming_status,
    p.tags
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN latest_visit lv ON lv.patient_id = p.patient_id
     LEFT JOIN imm_status isx ON isx.patient_id = p.patient_id
     LEFT JOIN vit_status vsx ON vsx.patient_id = p.patient_id
     LEFT JOIN dew_status dsx ON dsx.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | tcl_view                 | 5               | age_months                           | double precision            |  WITH latest_visit AS (
         SELECT v.patient_id,
            max(v.visit_date) AS latest_visit_date
           FROM visits v
          GROUP BY v.patient_id
        ), imm_status AS (
         SELECT s.patient_id,
            jsonb_agg(jsonb_build_object('antigen', vm.antigen_name, 'dose', s.dose_number, 'status', s.status, 'scheduled_date', s.scheduled_date, 'actual_date', s.actual_date) ORDER BY vm.antigen_name, s.dose_number) AS immunization_status
           FROM patientschedule s
             JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
          WHERE COALESCE(s.is_deleted, false) = false
          GROUP BY s.patient_id
        ), vit_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(vt.vitamina_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS vitamina_status
           FROM visits v
             LEFT JOIN vitamina vt ON vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false
          GROUP BY v.patient_id
        ), dew_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(d.deworming_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS deworming_status
           FROM visits v
             LEFT JOIN deworming d ON d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false
          GROUP BY v.patient_id
        )
 SELECT p.patient_id,
    p.full_name AS patient_name,
    p.sex,
    p.date_of_birth,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (30 * 24 * 60 * 60)::double precision AS age_months,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (24 * 60 * 60)::double precision AS age_days,
    p.barangay,
    p.health_center,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number AS guardian_contact,
    lv.latest_visit_date,
    COALESCE(isx.immunization_status, '[]'::jsonb) AS immunization_status,
    COALESCE(vsx.vitamina_status, 'No'::text) AS vitamina_status,
    COALESCE(dsx.deworming_status, 'No'::text) AS deworming_status,
    p.tags
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN latest_visit lv ON lv.patient_id = p.patient_id
     LEFT JOIN imm_status isx ON isx.patient_id = p.patient_id
     LEFT JOIN vit_status vsx ON vsx.patient_id = p.patient_id
     LEFT JOIN dew_status dsx ON dsx.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | tcl_view                 | 6               | age_days                             | double precision            |  WITH latest_visit AS (
         SELECT v.patient_id,
            max(v.visit_date) AS latest_visit_date
           FROM visits v
          GROUP BY v.patient_id
        ), imm_status AS (
         SELECT s.patient_id,
            jsonb_agg(jsonb_build_object('antigen', vm.antigen_name, 'dose', s.dose_number, 'status', s.status, 'scheduled_date', s.scheduled_date, 'actual_date', s.actual_date) ORDER BY vm.antigen_name, s.dose_number) AS immunization_status
           FROM patientschedule s
             JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
          WHERE COALESCE(s.is_deleted, false) = false
          GROUP BY s.patient_id
        ), vit_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(vt.vitamina_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS vitamina_status
           FROM visits v
             LEFT JOIN vitamina vt ON vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false
          GROUP BY v.patient_id
        ), dew_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(d.deworming_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS deworming_status
           FROM visits v
             LEFT JOIN deworming d ON d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false
          GROUP BY v.patient_id
        )
 SELECT p.patient_id,
    p.full_name AS patient_name,
    p.sex,
    p.date_of_birth,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (30 * 24 * 60 * 60)::double precision AS age_months,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (24 * 60 * 60)::double precision AS age_days,
    p.barangay,
    p.health_center,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number AS guardian_contact,
    lv.latest_visit_date,
    COALESCE(isx.immunization_status, '[]'::jsonb) AS immunization_status,
    COALESCE(vsx.vitamina_status, 'No'::text) AS vitamina_status,
    COALESCE(dsx.deworming_status, 'No'::text) AS deworming_status,
    p.tags
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN latest_visit lv ON lv.patient_id = p.patient_id
     LEFT JOIN imm_status isx ON isx.patient_id = p.patient_id
     LEFT JOIN vit_status vsx ON vsx.patient_id = p.patient_id
     LEFT JOIN dew_status dsx ON dsx.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | tcl_view                 | 7               | barangay                             | character varying           |  WITH latest_visit AS (
         SELECT v.patient_id,
            max(v.visit_date) AS latest_visit_date
           FROM visits v
          GROUP BY v.patient_id
        ), imm_status AS (
         SELECT s.patient_id,
            jsonb_agg(jsonb_build_object('antigen', vm.antigen_name, 'dose', s.dose_number, 'status', s.status, 'scheduled_date', s.scheduled_date, 'actual_date', s.actual_date) ORDER BY vm.antigen_name, s.dose_number) AS immunization_status
           FROM patientschedule s
             JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
          WHERE COALESCE(s.is_deleted, false) = false
          GROUP BY s.patient_id
        ), vit_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(vt.vitamina_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS vitamina_status
           FROM visits v
             LEFT JOIN vitamina vt ON vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false
          GROUP BY v.patient_id
        ), dew_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(d.deworming_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS deworming_status
           FROM visits v
             LEFT JOIN deworming d ON d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false
          GROUP BY v.patient_id
        )
 SELECT p.patient_id,
    p.full_name AS patient_name,
    p.sex,
    p.date_of_birth,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (30 * 24 * 60 * 60)::double precision AS age_months,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (24 * 60 * 60)::double precision AS age_days,
    p.barangay,
    p.health_center,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number AS guardian_contact,
    lv.latest_visit_date,
    COALESCE(isx.immunization_status, '[]'::jsonb) AS immunization_status,
    COALESCE(vsx.vitamina_status, 'No'::text) AS vitamina_status,
    COALESCE(dsx.deworming_status, 'No'::text) AS deworming_status,
    p.tags
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN latest_visit lv ON lv.patient_id = p.patient_id
     LEFT JOIN imm_status isx ON isx.patient_id = p.patient_id
     LEFT JOIN vit_status vsx ON vsx.patient_id = p.patient_id
     LEFT JOIN dew_status dsx ON dsx.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | tcl_view                 | 8               | health_center                        | character varying           |  WITH latest_visit AS (
         SELECT v.patient_id,
            max(v.visit_date) AS latest_visit_date
           FROM visits v
          GROUP BY v.patient_id
        ), imm_status AS (
         SELECT s.patient_id,
            jsonb_agg(jsonb_build_object('antigen', vm.antigen_name, 'dose', s.dose_number, 'status', s.status, 'scheduled_date', s.scheduled_date, 'actual_date', s.actual_date) ORDER BY vm.antigen_name, s.dose_number) AS immunization_status
           FROM patientschedule s
             JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
          WHERE COALESCE(s.is_deleted, false) = false
          GROUP BY s.patient_id
        ), vit_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(vt.vitamina_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS vitamina_status
           FROM visits v
             LEFT JOIN vitamina vt ON vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false
          GROUP BY v.patient_id
        ), dew_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(d.deworming_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS deworming_status
           FROM visits v
             LEFT JOIN deworming d ON d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false
          GROUP BY v.patient_id
        )
 SELECT p.patient_id,
    p.full_name AS patient_name,
    p.sex,
    p.date_of_birth,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (30 * 24 * 60 * 60)::double precision AS age_months,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (24 * 60 * 60)::double precision AS age_days,
    p.barangay,
    p.health_center,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number AS guardian_contact,
    lv.latest_visit_date,
    COALESCE(isx.immunization_status, '[]'::jsonb) AS immunization_status,
    COALESCE(vsx.vitamina_status, 'No'::text) AS vitamina_status,
    COALESCE(dsx.deworming_status, 'No'::text) AS deworming_status,
    p.tags
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN latest_visit lv ON lv.patient_id = p.patient_id
     LEFT JOIN imm_status isx ON isx.patient_id = p.patient_id
     LEFT JOIN vit_status vsx ON vsx.patient_id = p.patient_id
     LEFT JOIN dew_status dsx ON dsx.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | tcl_view                 | 9               | guardian_name                        | text                        |  WITH latest_visit AS (
         SELECT v.patient_id,
            max(v.visit_date) AS latest_visit_date
           FROM visits v
          GROUP BY v.patient_id
        ), imm_status AS (
         SELECT s.patient_id,
            jsonb_agg(jsonb_build_object('antigen', vm.antigen_name, 'dose', s.dose_number, 'status', s.status, 'scheduled_date', s.scheduled_date, 'actual_date', s.actual_date) ORDER BY vm.antigen_name, s.dose_number) AS immunization_status
           FROM patientschedule s
             JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
          WHERE COALESCE(s.is_deleted, false) = false
          GROUP BY s.patient_id
        ), vit_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(vt.vitamina_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS vitamina_status
           FROM visits v
             LEFT JOIN vitamina vt ON vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false
          GROUP BY v.patient_id
        ), dew_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(d.deworming_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS deworming_status
           FROM visits v
             LEFT JOIN deworming d ON d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false
          GROUP BY v.patient_id
        )
 SELECT p.patient_id,
    p.full_name AS patient_name,
    p.sex,
    p.date_of_birth,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (30 * 24 * 60 * 60)::double precision AS age_months,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (24 * 60 * 60)::double precision AS age_days,
    p.barangay,
    p.health_center,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number AS guardian_contact,
    lv.latest_visit_date,
    COALESCE(isx.immunization_status, '[]'::jsonb) AS immunization_status,
    COALESCE(vsx.vitamina_status, 'No'::text) AS vitamina_status,
    COALESCE(dsx.deworming_status, 'No'::text) AS deworming_status,
    p.tags
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN latest_visit lv ON lv.patient_id = p.patient_id
     LEFT JOIN imm_status isx ON isx.patient_id = p.patient_id
     LEFT JOIN vit_status vsx ON vsx.patient_id = p.patient_id
     LEFT JOIN dew_status dsx ON dsx.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | tcl_view                 | 10              | guardian_contact                     | character varying           |  WITH latest_visit AS (
         SELECT v.patient_id,
            max(v.visit_date) AS latest_visit_date
           FROM visits v
          GROUP BY v.patient_id
        ), imm_status AS (
         SELECT s.patient_id,
            jsonb_agg(jsonb_build_object('antigen', vm.antigen_name, 'dose', s.dose_number, 'status', s.status, 'scheduled_date', s.scheduled_date, 'actual_date', s.actual_date) ORDER BY vm.antigen_name, s.dose_number) AS immunization_status
           FROM patientschedule s
             JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
          WHERE COALESCE(s.is_deleted, false) = false
          GROUP BY s.patient_id
        ), vit_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(vt.vitamina_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS vitamina_status
           FROM visits v
             LEFT JOIN vitamina vt ON vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false
          GROUP BY v.patient_id
        ), dew_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(d.deworming_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS deworming_status
           FROM visits v
             LEFT JOIN deworming d ON d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false
          GROUP BY v.patient_id
        )
 SELECT p.patient_id,
    p.full_name AS patient_name,
    p.sex,
    p.date_of_birth,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (30 * 24 * 60 * 60)::double precision AS age_months,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (24 * 60 * 60)::double precision AS age_days,
    p.barangay,
    p.health_center,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number AS guardian_contact,
    lv.latest_visit_date,
    COALESCE(isx.immunization_status, '[]'::jsonb) AS immunization_status,
    COALESCE(vsx.vitamina_status, 'No'::text) AS vitamina_status,
    COALESCE(dsx.deworming_status, 'No'::text) AS deworming_status,
    p.tags
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN latest_visit lv ON lv.patient_id = p.patient_id
     LEFT JOIN imm_status isx ON isx.patient_id = p.patient_id
     LEFT JOIN vit_status vsx ON vsx.patient_id = p.patient_id
     LEFT JOIN dew_status dsx ON dsx.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | tcl_view                 | 11              | latest_visit_date                    | date                        |  WITH latest_visit AS (
         SELECT v.patient_id,
            max(v.visit_date) AS latest_visit_date
           FROM visits v
          GROUP BY v.patient_id
        ), imm_status AS (
         SELECT s.patient_id,
            jsonb_agg(jsonb_build_object('antigen', vm.antigen_name, 'dose', s.dose_number, 'status', s.status, 'scheduled_date', s.scheduled_date, 'actual_date', s.actual_date) ORDER BY vm.antigen_name, s.dose_number) AS immunization_status
           FROM patientschedule s
             JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
          WHERE COALESCE(s.is_deleted, false) = false
          GROUP BY s.patient_id
        ), vit_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(vt.vitamina_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS vitamina_status
           FROM visits v
             LEFT JOIN vitamina vt ON vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false
          GROUP BY v.patient_id
        ), dew_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(d.deworming_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS deworming_status
           FROM visits v
             LEFT JOIN deworming d ON d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false
          GROUP BY v.patient_id
        )
 SELECT p.patient_id,
    p.full_name AS patient_name,
    p.sex,
    p.date_of_birth,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (30 * 24 * 60 * 60)::double precision AS age_months,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (24 * 60 * 60)::double precision AS age_days,
    p.barangay,
    p.health_center,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number AS guardian_contact,
    lv.latest_visit_date,
    COALESCE(isx.immunization_status, '[]'::jsonb) AS immunization_status,
    COALESCE(vsx.vitamina_status, 'No'::text) AS vitamina_status,
    COALESCE(dsx.deworming_status, 'No'::text) AS deworming_status,
    p.tags
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN latest_visit lv ON lv.patient_id = p.patient_id
     LEFT JOIN imm_status isx ON isx.patient_id = p.patient_id
     LEFT JOIN vit_status vsx ON vsx.patient_id = p.patient_id
     LEFT JOIN dew_status dsx ON dsx.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | tcl_view                 | 12              | immunization_status                  | jsonb                       |  WITH latest_visit AS (
         SELECT v.patient_id,
            max(v.visit_date) AS latest_visit_date
           FROM visits v
          GROUP BY v.patient_id
        ), imm_status AS (
         SELECT s.patient_id,
            jsonb_agg(jsonb_build_object('antigen', vm.antigen_name, 'dose', s.dose_number, 'status', s.status, 'scheduled_date', s.scheduled_date, 'actual_date', s.actual_date) ORDER BY vm.antigen_name, s.dose_number) AS immunization_status
           FROM patientschedule s
             JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
          WHERE COALESCE(s.is_deleted, false) = false
          GROUP BY s.patient_id
        ), vit_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(vt.vitamina_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS vitamina_status
           FROM visits v
             LEFT JOIN vitamina vt ON vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false
          GROUP BY v.patient_id
        ), dew_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(d.deworming_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS deworming_status
           FROM visits v
             LEFT JOIN deworming d ON d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false
          GROUP BY v.patient_id
        )
 SELECT p.patient_id,
    p.full_name AS patient_name,
    p.sex,
    p.date_of_birth,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (30 * 24 * 60 * 60)::double precision AS age_months,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (24 * 60 * 60)::double precision AS age_days,
    p.barangay,
    p.health_center,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number AS guardian_contact,
    lv.latest_visit_date,
    COALESCE(isx.immunization_status, '[]'::jsonb) AS immunization_status,
    COALESCE(vsx.vitamina_status, 'No'::text) AS vitamina_status,
    COALESCE(dsx.deworming_status, 'No'::text) AS deworming_status,
    p.tags
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN latest_visit lv ON lv.patient_id = p.patient_id
     LEFT JOIN imm_status isx ON isx.patient_id = p.patient_id
     LEFT JOIN vit_status vsx ON vsx.patient_id = p.patient_id
     LEFT JOIN dew_status dsx ON dsx.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | tcl_view                 | 13              | vitamina_status                      | text                        |  WITH latest_visit AS (
         SELECT v.patient_id,
            max(v.visit_date) AS latest_visit_date
           FROM visits v
          GROUP BY v.patient_id
        ), imm_status AS (
         SELECT s.patient_id,
            jsonb_agg(jsonb_build_object('antigen', vm.antigen_name, 'dose', s.dose_number, 'status', s.status, 'scheduled_date', s.scheduled_date, 'actual_date', s.actual_date) ORDER BY vm.antigen_name, s.dose_number) AS immunization_status
           FROM patientschedule s
             JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
          WHERE COALESCE(s.is_deleted, false) = false
          GROUP BY s.patient_id
        ), vit_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(vt.vitamina_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS vitamina_status
           FROM visits v
             LEFT JOIN vitamina vt ON vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false
          GROUP BY v.patient_id
        ), dew_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(d.deworming_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS deworming_status
           FROM visits v
             LEFT JOIN deworming d ON d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false
          GROUP BY v.patient_id
        )
 SELECT p.patient_id,
    p.full_name AS patient_name,
    p.sex,
    p.date_of_birth,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (30 * 24 * 60 * 60)::double precision AS age_months,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (24 * 60 * 60)::double precision AS age_days,
    p.barangay,
    p.health_center,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number AS guardian_contact,
    lv.latest_visit_date,
    COALESCE(isx.immunization_status, '[]'::jsonb) AS immunization_status,
    COALESCE(vsx.vitamina_status, 'No'::text) AS vitamina_status,
    COALESCE(dsx.deworming_status, 'No'::text) AS deworming_status,
    p.tags
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN latest_visit lv ON lv.patient_id = p.patient_id
     LEFT JOIN imm_status isx ON isx.patient_id = p.patient_id
     LEFT JOIN vit_status vsx ON vsx.patient_id = p.patient_id
     LEFT JOIN dew_status dsx ON dsx.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | tcl_view                 | 14              | deworming_status                     | text                        |  WITH latest_visit AS (
         SELECT v.patient_id,
            max(v.visit_date) AS latest_visit_date
           FROM visits v
          GROUP BY v.patient_id
        ), imm_status AS (
         SELECT s.patient_id,
            jsonb_agg(jsonb_build_object('antigen', vm.antigen_name, 'dose', s.dose_number, 'status', s.status, 'scheduled_date', s.scheduled_date, 'actual_date', s.actual_date) ORDER BY vm.antigen_name, s.dose_number) AS immunization_status
           FROM patientschedule s
             JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
          WHERE COALESCE(s.is_deleted, false) = false
          GROUP BY s.patient_id
        ), vit_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(vt.vitamina_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS vitamina_status
           FROM visits v
             LEFT JOIN vitamina vt ON vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false
          GROUP BY v.patient_id
        ), dew_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(d.deworming_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS deworming_status
           FROM visits v
             LEFT JOIN deworming d ON d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false
          GROUP BY v.patient_id
        )
 SELECT p.patient_id,
    p.full_name AS patient_name,
    p.sex,
    p.date_of_birth,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (30 * 24 * 60 * 60)::double precision AS age_months,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (24 * 60 * 60)::double precision AS age_days,
    p.barangay,
    p.health_center,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number AS guardian_contact,
    lv.latest_visit_date,
    COALESCE(isx.immunization_status, '[]'::jsonb) AS immunization_status,
    COALESCE(vsx.vitamina_status, 'No'::text) AS vitamina_status,
    COALESCE(dsx.deworming_status, 'No'::text) AS deworming_status,
    p.tags
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN latest_visit lv ON lv.patient_id = p.patient_id
     LEFT JOIN imm_status isx ON isx.patient_id = p.patient_id
     LEFT JOIN vit_status vsx ON vsx.patient_id = p.patient_id
     LEFT JOIN dew_status dsx ON dsx.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | tcl_view                 | 15              | tags                                 | character varying           |  WITH latest_visit AS (
         SELECT v.patient_id,
            max(v.visit_date) AS latest_visit_date
           FROM visits v
          GROUP BY v.patient_id
        ), imm_status AS (
         SELECT s.patient_id,
            jsonb_agg(jsonb_build_object('antigen', vm.antigen_name, 'dose', s.dose_number, 'status', s.status, 'scheduled_date', s.scheduled_date, 'actual_date', s.actual_date) ORDER BY vm.antigen_name, s.dose_number) AS immunization_status
           FROM patientschedule s
             JOIN vaccinemaster vm ON vm.vaccine_id = s.vaccine_id
          WHERE COALESCE(s.is_deleted, false) = false
          GROUP BY s.patient_id
        ), vit_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(vt.vitamina_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS vitamina_status
           FROM visits v
             LEFT JOIN vitamina vt ON vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false
          GROUP BY v.patient_id
        ), dew_status AS (
         SELECT v.patient_id,
                CASE
                    WHEN count(d.deworming_id) > 0 THEN 'Yes'::text
                    ELSE 'No'::text
                END AS deworming_status
           FROM visits v
             LEFT JOIN deworming d ON d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false
          GROUP BY v.patient_id
        )
 SELECT p.patient_id,
    p.full_name AS patient_name,
    p.sex,
    p.date_of_birth,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (30 * 24 * 60 * 60)::double precision AS age_months,
    EXTRACT(epoch FROM CURRENT_DATE::timestamp without time zone - p.date_of_birth::timestamp without time zone)::double precision / (24 * 60 * 60)::double precision AS age_days,
    p.barangay,
    p.health_center,
    ((g.surname::text || ', '::text) || g.firstname::text) || COALESCE(' '::text || g.middlename::text, ''::text) AS guardian_name,
    g.contact_number AS guardian_contact,
    lv.latest_visit_date,
    COALESCE(isx.immunization_status, '[]'::jsonb) AS immunization_status,
    COALESCE(vsx.vitamina_status, 'No'::text) AS vitamina_status,
    COALESCE(dsx.deworming_status, 'No'::text) AS deworming_status,
    p.tags
   FROM patients p
     LEFT JOIN guardians g ON g.guardian_id = p.guardian_id
     LEFT JOIN latest_visit lv ON lv.patient_id = p.patient_id
     LEFT JOIN imm_status isx ON isx.patient_id = p.patient_id
     LEFT JOIN vit_status vsx ON vsx.patient_id = p.patient_id
     LEFT JOIN dew_status dsx ON dsx.patient_id = p.patient_id
  WHERE COALESCE(p.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public | users_with_uuid          | 1               | user_id                              | bigint                      |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 2               | username                             | character varying           |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 3               | email                                | character varying           |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 4               | role                                 | character varying           |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 5               | hs_type                              | text                        |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 6               | firstname                            | character varying           |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 7               | middlename                           | character varying           |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 8               | surname                              | character varying           |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 9               | contact_number                       | character varying           |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 10              | address                              | text                        |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 11              | sex                                  | character varying           |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 12              | birthdate                            | date                        |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 13              | employee_id                          | character varying           |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 14              | professional_license_no              | character varying           |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 15              | created_by                           | bigint                      |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 16              | updated_by                           | bigint                      |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 17              | date_registered                      | timestamp without time zone |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 18              | last_login                           | timestamp without time zone |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 19              | is_deleted                           | boolean                     |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | users_with_uuid          | 20              | supabase_uuid                        | uuid                        |  SELECT u.user_id,
    u.username,
    u.email,
    u.role,
    u.hs_type,
    u.firstname,
    u.middlename,
    u.surname,
    u.contact_number,
    u.address,
    u.sex,
    u.birthdate,
    u.employee_id,
    u.professional_license_no,
    u.created_by,
    u.updated_by,
    u.date_registered,
    u.last_login,
    u.is_deleted,
    um.uuid AS supabase_uuid
   FROM users u
     LEFT JOIN user_mapping um ON u.user_id = um.user_id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public | vaccine_report_view      | 1               | antigen_name                         | character varying           |  WITH base AS (
         SELECT vm.antigen_name,
            im.dose_number,
            p.sex,
                CASE
                    WHEN COALESCE(im.administered_date, v.visit_date) <= (p.date_of_birth + '1 day'::interval) THEN 'within'::text
                    ELSE 'after'::text
                END AS timing
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
        )
 SELECT antigen_name,
    dose_number,
    count(*) FILTER (WHERE timing = 'within'::text) AS within_24h_total,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Male'::text) AS within_24h_male,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Female'::text) AS within_24h_female,
    count(*) FILTER (WHERE timing = 'after'::text) AS after_24h_total,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Male'::text) AS after_24h_male,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Female'::text) AS after_24h_female
   FROM base
  GROUP BY antigen_name, dose_number
  ORDER BY antigen_name, dose_number;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public | vaccine_report_view      | 2               | dose_number                          | integer                     |  WITH base AS (
         SELECT vm.antigen_name,
            im.dose_number,
            p.sex,
                CASE
                    WHEN COALESCE(im.administered_date, v.visit_date) <= (p.date_of_birth + '1 day'::interval) THEN 'within'::text
                    ELSE 'after'::text
                END AS timing
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
        )
 SELECT antigen_name,
    dose_number,
    count(*) FILTER (WHERE timing = 'within'::text) AS within_24h_total,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Male'::text) AS within_24h_male,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Female'::text) AS within_24h_female,
    count(*) FILTER (WHERE timing = 'after'::text) AS after_24h_total,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Male'::text) AS after_24h_male,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Female'::text) AS after_24h_female
   FROM base
  GROUP BY antigen_name, dose_number
  ORDER BY antigen_name, dose_number;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public | vaccine_report_view      | 3               | within_24h_total                     | bigint                      |  WITH base AS (
         SELECT vm.antigen_name,
            im.dose_number,
            p.sex,
                CASE
                    WHEN COALESCE(im.administered_date, v.visit_date) <= (p.date_of_birth + '1 day'::interval) THEN 'within'::text
                    ELSE 'after'::text
                END AS timing
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
        )
 SELECT antigen_name,
    dose_number,
    count(*) FILTER (WHERE timing = 'within'::text) AS within_24h_total,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Male'::text) AS within_24h_male,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Female'::text) AS within_24h_female,
    count(*) FILTER (WHERE timing = 'after'::text) AS after_24h_total,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Male'::text) AS after_24h_male,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Female'::text) AS after_24h_female
   FROM base
  GROUP BY antigen_name, dose_number
  ORDER BY antigen_name, dose_number;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public | vaccine_report_view      | 4               | within_24h_male                      | bigint                      |  WITH base AS (
         SELECT vm.antigen_name,
            im.dose_number,
            p.sex,
                CASE
                    WHEN COALESCE(im.administered_date, v.visit_date) <= (p.date_of_birth + '1 day'::interval) THEN 'within'::text
                    ELSE 'after'::text
                END AS timing
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
        )
 SELECT antigen_name,
    dose_number,
    count(*) FILTER (WHERE timing = 'within'::text) AS within_24h_total,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Male'::text) AS within_24h_male,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Female'::text) AS within_24h_female,
    count(*) FILTER (WHERE timing = 'after'::text) AS after_24h_total,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Male'::text) AS after_24h_male,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Female'::text) AS after_24h_female
   FROM base
  GROUP BY antigen_name, dose_number
  ORDER BY antigen_name, dose_number;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public | vaccine_report_view      | 5               | within_24h_female                    | bigint                      |  WITH base AS (
         SELECT vm.antigen_name,
            im.dose_number,
            p.sex,
                CASE
                    WHEN COALESCE(im.administered_date, v.visit_date) <= (p.date_of_birth + '1 day'::interval) THEN 'within'::text
                    ELSE 'after'::text
                END AS timing
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
        )
 SELECT antigen_name,
    dose_number,
    count(*) FILTER (WHERE timing = 'within'::text) AS within_24h_total,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Male'::text) AS within_24h_male,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Female'::text) AS within_24h_female,
    count(*) FILTER (WHERE timing = 'after'::text) AS after_24h_total,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Male'::text) AS after_24h_male,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Female'::text) AS after_24h_female
   FROM base
  GROUP BY antigen_name, dose_number
  ORDER BY antigen_name, dose_number;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public | vaccine_report_view      | 6               | after_24h_total                      | bigint                      |  WITH base AS (
         SELECT vm.antigen_name,
            im.dose_number,
            p.sex,
                CASE
                    WHEN COALESCE(im.administered_date, v.visit_date) <= (p.date_of_birth + '1 day'::interval) THEN 'within'::text
                    ELSE 'after'::text
                END AS timing
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
        )
 SELECT antigen_name,
    dose_number,
    count(*) FILTER (WHERE timing = 'within'::text) AS within_24h_total,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Male'::text) AS within_24h_male,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Female'::text) AS within_24h_female,
    count(*) FILTER (WHERE timing = 'after'::text) AS after_24h_total,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Male'::text) AS after_24h_male,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Female'::text) AS after_24h_female
   FROM base
  GROUP BY antigen_name, dose_number
  ORDER BY antigen_name, dose_number;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public | vaccine_report_view      | 7               | after_24h_male                       | bigint                      |  WITH base AS (
         SELECT vm.antigen_name,
            im.dose_number,
            p.sex,
                CASE
                    WHEN COALESCE(im.administered_date, v.visit_date) <= (p.date_of_birth + '1 day'::interval) THEN 'within'::text
                    ELSE 'after'::text
                END AS timing
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
        )
 SELECT antigen_name,
    dose_number,
    count(*) FILTER (WHERE timing = 'within'::text) AS within_24h_total,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Male'::text) AS within_24h_male,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Female'::text) AS within_24h_female,
    count(*) FILTER (WHERE timing = 'after'::text) AS after_24h_total,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Male'::text) AS after_24h_male,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Female'::text) AS after_24h_female
   FROM base
  GROUP BY antigen_name, dose_number
  ORDER BY antigen_name, dose_number;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public | vaccine_report_view      | 8               | after_24h_female                     | bigint                      |  WITH base AS (
         SELECT vm.antigen_name,
            im.dose_number,
            p.sex,
                CASE
                    WHEN COALESCE(im.administered_date, v.visit_date) <= (p.date_of_birth + '1 day'::interval) THEN 'within'::text
                    ELSE 'after'::text
                END AS timing
           FROM immunizations im
             LEFT JOIN visits v ON v.visit_id = im.visit_id
             JOIN patients p ON p.patient_id = v.patient_id
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE COALESCE(im.is_deleted, false) = false
        )
 SELECT antigen_name,
    dose_number,
    count(*) FILTER (WHERE timing = 'within'::text) AS within_24h_total,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Male'::text) AS within_24h_male,
    count(*) FILTER (WHERE timing = 'within'::text AND sex::text = 'Female'::text) AS within_24h_female,
    count(*) FILTER (WHERE timing = 'after'::text) AS after_24h_total,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Male'::text) AS after_24h_male,
    count(*) FILTER (WHERE timing = 'after'::text AND sex::text = 'Female'::text) AS after_24h_female
   FROM base
  GROUP BY antigen_name, dose_number
  ORDER BY antigen_name, dose_number;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public | visits_view              | 1               | visit_id                             | bigint                      |  SELECT v.visit_id,
    v.patient_id,
    p.full_name AS patient_name,
    v.visit_date,
    v.findings,
    v.service_rendered,
    ru.full_name AS recorded_by,
    ( SELECT COALESCE(json_agg(json_build_object('vaccine_id', im.vaccine_id, 'antigen_name', vm.antigen_name, 'dose_number', im.dose_number, 'administered_date', timezone('Asia/Manila'::text, im.administered_date::timestamp with time zone), 'outside', COALESCE(im.outside, false)) ORDER BY vm.antigen_name, im.dose_number), '[]'::json) AS "coalesce"
           FROM immunizations im
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE im.visit_id = v.visit_id AND COALESCE(im.is_deleted, false) = false) AS immunizations_given,
    (EXISTS ( SELECT 1
           FROM vitamina vt
          WHERE vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false)) AS vitamina_given,
    (EXISTS ( SELECT 1
           FROM deworming d
          WHERE d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false)) AS deworming_given,
    ( SELECT json_build_object('temperature', vs.temperature, 'respiration_rate', vs.respiration_rate, 'weight', vs.weight, 'height_length', vs.height_length, 'muac', vs.muac) AS json_build_object
           FROM vitalsigns vs
          WHERE vs.visit_id = v.visit_id AND COALESCE(vs.is_deleted, false) = false
          ORDER BY vs.created_at DESC NULLS LAST
         LIMIT 1) AS vital_signs
   FROM visits v
     JOIN patients p ON p.patient_id = v.patient_id
     LEFT JOIN users ru ON ru.user_id = v.recorded_by
  WHERE COALESCE(v.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | visits_view              | 2               | patient_id                           | bigint                      |  SELECT v.visit_id,
    v.patient_id,
    p.full_name AS patient_name,
    v.visit_date,
    v.findings,
    v.service_rendered,
    ru.full_name AS recorded_by,
    ( SELECT COALESCE(json_agg(json_build_object('vaccine_id', im.vaccine_id, 'antigen_name', vm.antigen_name, 'dose_number', im.dose_number, 'administered_date', timezone('Asia/Manila'::text, im.administered_date::timestamp with time zone), 'outside', COALESCE(im.outside, false)) ORDER BY vm.antigen_name, im.dose_number), '[]'::json) AS "coalesce"
           FROM immunizations im
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE im.visit_id = v.visit_id AND COALESCE(im.is_deleted, false) = false) AS immunizations_given,
    (EXISTS ( SELECT 1
           FROM vitamina vt
          WHERE vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false)) AS vitamina_given,
    (EXISTS ( SELECT 1
           FROM deworming d
          WHERE d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false)) AS deworming_given,
    ( SELECT json_build_object('temperature', vs.temperature, 'respiration_rate', vs.respiration_rate, 'weight', vs.weight, 'height_length', vs.height_length, 'muac', vs.muac) AS json_build_object
           FROM vitalsigns vs
          WHERE vs.visit_id = v.visit_id AND COALESCE(vs.is_deleted, false) = false
          ORDER BY vs.created_at DESC NULLS LAST
         LIMIT 1) AS vital_signs
   FROM visits v
     JOIN patients p ON p.patient_id = v.patient_id
     LEFT JOIN users ru ON ru.user_id = v.recorded_by
  WHERE COALESCE(v.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | visits_view              | 3               | patient_name                         | text                        |  SELECT v.visit_id,
    v.patient_id,
    p.full_name AS patient_name,
    v.visit_date,
    v.findings,
    v.service_rendered,
    ru.full_name AS recorded_by,
    ( SELECT COALESCE(json_agg(json_build_object('vaccine_id', im.vaccine_id, 'antigen_name', vm.antigen_name, 'dose_number', im.dose_number, 'administered_date', timezone('Asia/Manila'::text, im.administered_date::timestamp with time zone), 'outside', COALESCE(im.outside, false)) ORDER BY vm.antigen_name, im.dose_number), '[]'::json) AS "coalesce"
           FROM immunizations im
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE im.visit_id = v.visit_id AND COALESCE(im.is_deleted, false) = false) AS immunizations_given,
    (EXISTS ( SELECT 1
           FROM vitamina vt
          WHERE vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false)) AS vitamina_given,
    (EXISTS ( SELECT 1
           FROM deworming d
          WHERE d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false)) AS deworming_given,
    ( SELECT json_build_object('temperature', vs.temperature, 'respiration_rate', vs.respiration_rate, 'weight', vs.weight, 'height_length', vs.height_length, 'muac', vs.muac) AS json_build_object
           FROM vitalsigns vs
          WHERE vs.visit_id = v.visit_id AND COALESCE(vs.is_deleted, false) = false
          ORDER BY vs.created_at DESC NULLS LAST
         LIMIT 1) AS vital_signs
   FROM visits v
     JOIN patients p ON p.patient_id = v.patient_id
     LEFT JOIN users ru ON ru.user_id = v.recorded_by
  WHERE COALESCE(v.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | visits_view              | 4               | visit_date                           | date                        |  SELECT v.visit_id,
    v.patient_id,
    p.full_name AS patient_name,
    v.visit_date,
    v.findings,
    v.service_rendered,
    ru.full_name AS recorded_by,
    ( SELECT COALESCE(json_agg(json_build_object('vaccine_id', im.vaccine_id, 'antigen_name', vm.antigen_name, 'dose_number', im.dose_number, 'administered_date', timezone('Asia/Manila'::text, im.administered_date::timestamp with time zone), 'outside', COALESCE(im.outside, false)) ORDER BY vm.antigen_name, im.dose_number), '[]'::json) AS "coalesce"
           FROM immunizations im
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE im.visit_id = v.visit_id AND COALESCE(im.is_deleted, false) = false) AS immunizations_given,
    (EXISTS ( SELECT 1
           FROM vitamina vt
          WHERE vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false)) AS vitamina_given,
    (EXISTS ( SELECT 1
           FROM deworming d
          WHERE d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false)) AS deworming_given,
    ( SELECT json_build_object('temperature', vs.temperature, 'respiration_rate', vs.respiration_rate, 'weight', vs.weight, 'height_length', vs.height_length, 'muac', vs.muac) AS json_build_object
           FROM vitalsigns vs
          WHERE vs.visit_id = v.visit_id AND COALESCE(vs.is_deleted, false) = false
          ORDER BY vs.created_at DESC NULLS LAST
         LIMIT 1) AS vital_signs
   FROM visits v
     JOIN patients p ON p.patient_id = v.patient_id
     LEFT JOIN users ru ON ru.user_id = v.recorded_by
  WHERE COALESCE(v.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | visits_view              | 5               | findings                             | text                        |  SELECT v.visit_id,
    v.patient_id,
    p.full_name AS patient_name,
    v.visit_date,
    v.findings,
    v.service_rendered,
    ru.full_name AS recorded_by,
    ( SELECT COALESCE(json_agg(json_build_object('vaccine_id', im.vaccine_id, 'antigen_name', vm.antigen_name, 'dose_number', im.dose_number, 'administered_date', timezone('Asia/Manila'::text, im.administered_date::timestamp with time zone), 'outside', COALESCE(im.outside, false)) ORDER BY vm.antigen_name, im.dose_number), '[]'::json) AS "coalesce"
           FROM immunizations im
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE im.visit_id = v.visit_id AND COALESCE(im.is_deleted, false) = false) AS immunizations_given,
    (EXISTS ( SELECT 1
           FROM vitamina vt
          WHERE vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false)) AS vitamina_given,
    (EXISTS ( SELECT 1
           FROM deworming d
          WHERE d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false)) AS deworming_given,
    ( SELECT json_build_object('temperature', vs.temperature, 'respiration_rate', vs.respiration_rate, 'weight', vs.weight, 'height_length', vs.height_length, 'muac', vs.muac) AS json_build_object
           FROM vitalsigns vs
          WHERE vs.visit_id = v.visit_id AND COALESCE(vs.is_deleted, false) = false
          ORDER BY vs.created_at DESC NULLS LAST
         LIMIT 1) AS vital_signs
   FROM visits v
     JOIN patients p ON p.patient_id = v.patient_id
     LEFT JOIN users ru ON ru.user_id = v.recorded_by
  WHERE COALESCE(v.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | visits_view              | 6               | service_rendered                     | text                        |  SELECT v.visit_id,
    v.patient_id,
    p.full_name AS patient_name,
    v.visit_date,
    v.findings,
    v.service_rendered,
    ru.full_name AS recorded_by,
    ( SELECT COALESCE(json_agg(json_build_object('vaccine_id', im.vaccine_id, 'antigen_name', vm.antigen_name, 'dose_number', im.dose_number, 'administered_date', timezone('Asia/Manila'::text, im.administered_date::timestamp with time zone), 'outside', COALESCE(im.outside, false)) ORDER BY vm.antigen_name, im.dose_number), '[]'::json) AS "coalesce"
           FROM immunizations im
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE im.visit_id = v.visit_id AND COALESCE(im.is_deleted, false) = false) AS immunizations_given,
    (EXISTS ( SELECT 1
           FROM vitamina vt
          WHERE vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false)) AS vitamina_given,
    (EXISTS ( SELECT 1
           FROM deworming d
          WHERE d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false)) AS deworming_given,
    ( SELECT json_build_object('temperature', vs.temperature, 'respiration_rate', vs.respiration_rate, 'weight', vs.weight, 'height_length', vs.height_length, 'muac', vs.muac) AS json_build_object
           FROM vitalsigns vs
          WHERE vs.visit_id = v.visit_id AND COALESCE(vs.is_deleted, false) = false
          ORDER BY vs.created_at DESC NULLS LAST
         LIMIT 1) AS vital_signs
   FROM visits v
     JOIN patients p ON p.patient_id = v.patient_id
     LEFT JOIN users ru ON ru.user_id = v.recorded_by
  WHERE COALESCE(v.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | visits_view              | 7               | recorded_by                          | text                        |  SELECT v.visit_id,
    v.patient_id,
    p.full_name AS patient_name,
    v.visit_date,
    v.findings,
    v.service_rendered,
    ru.full_name AS recorded_by,
    ( SELECT COALESCE(json_agg(json_build_object('vaccine_id', im.vaccine_id, 'antigen_name', vm.antigen_name, 'dose_number', im.dose_number, 'administered_date', timezone('Asia/Manila'::text, im.administered_date::timestamp with time zone), 'outside', COALESCE(im.outside, false)) ORDER BY vm.antigen_name, im.dose_number), '[]'::json) AS "coalesce"
           FROM immunizations im
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE im.visit_id = v.visit_id AND COALESCE(im.is_deleted, false) = false) AS immunizations_given,
    (EXISTS ( SELECT 1
           FROM vitamina vt
          WHERE vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false)) AS vitamina_given,
    (EXISTS ( SELECT 1
           FROM deworming d
          WHERE d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false)) AS deworming_given,
    ( SELECT json_build_object('temperature', vs.temperature, 'respiration_rate', vs.respiration_rate, 'weight', vs.weight, 'height_length', vs.height_length, 'muac', vs.muac) AS json_build_object
           FROM vitalsigns vs
          WHERE vs.visit_id = v.visit_id AND COALESCE(vs.is_deleted, false) = false
          ORDER BY vs.created_at DESC NULLS LAST
         LIMIT 1) AS vital_signs
   FROM visits v
     JOIN patients p ON p.patient_id = v.patient_id
     LEFT JOIN users ru ON ru.user_id = v.recorded_by
  WHERE COALESCE(v.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | visits_view              | 8               | immunizations_given                  | json                        |  SELECT v.visit_id,
    v.patient_id,
    p.full_name AS patient_name,
    v.visit_date,
    v.findings,
    v.service_rendered,
    ru.full_name AS recorded_by,
    ( SELECT COALESCE(json_agg(json_build_object('vaccine_id', im.vaccine_id, 'antigen_name', vm.antigen_name, 'dose_number', im.dose_number, 'administered_date', timezone('Asia/Manila'::text, im.administered_date::timestamp with time zone), 'outside', COALESCE(im.outside, false)) ORDER BY vm.antigen_name, im.dose_number), '[]'::json) AS "coalesce"
           FROM immunizations im
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE im.visit_id = v.visit_id AND COALESCE(im.is_deleted, false) = false) AS immunizations_given,
    (EXISTS ( SELECT 1
           FROM vitamina vt
          WHERE vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false)) AS vitamina_given,
    (EXISTS ( SELECT 1
           FROM deworming d
          WHERE d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false)) AS deworming_given,
    ( SELECT json_build_object('temperature', vs.temperature, 'respiration_rate', vs.respiration_rate, 'weight', vs.weight, 'height_length', vs.height_length, 'muac', vs.muac) AS json_build_object
           FROM vitalsigns vs
          WHERE vs.visit_id = v.visit_id AND COALESCE(vs.is_deleted, false) = false
          ORDER BY vs.created_at DESC NULLS LAST
         LIMIT 1) AS vital_signs
   FROM visits v
     JOIN patients p ON p.patient_id = v.patient_id
     LEFT JOIN users ru ON ru.user_id = v.recorded_by
  WHERE COALESCE(v.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | visits_view              | 9               | vitamina_given                       | boolean                     |  SELECT v.visit_id,
    v.patient_id,
    p.full_name AS patient_name,
    v.visit_date,
    v.findings,
    v.service_rendered,
    ru.full_name AS recorded_by,
    ( SELECT COALESCE(json_agg(json_build_object('vaccine_id', im.vaccine_id, 'antigen_name', vm.antigen_name, 'dose_number', im.dose_number, 'administered_date', timezone('Asia/Manila'::text, im.administered_date::timestamp with time zone), 'outside', COALESCE(im.outside, false)) ORDER BY vm.antigen_name, im.dose_number), '[]'::json) AS "coalesce"
           FROM immunizations im
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE im.visit_id = v.visit_id AND COALESCE(im.is_deleted, false) = false) AS immunizations_given,
    (EXISTS ( SELECT 1
           FROM vitamina vt
          WHERE vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false)) AS vitamina_given,
    (EXISTS ( SELECT 1
           FROM deworming d
          WHERE d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false)) AS deworming_given,
    ( SELECT json_build_object('temperature', vs.temperature, 'respiration_rate', vs.respiration_rate, 'weight', vs.weight, 'height_length', vs.height_length, 'muac', vs.muac) AS json_build_object
           FROM vitalsigns vs
          WHERE vs.visit_id = v.visit_id AND COALESCE(vs.is_deleted, false) = false
          ORDER BY vs.created_at DESC NULLS LAST
         LIMIT 1) AS vital_signs
   FROM visits v
     JOIN patients p ON p.patient_id = v.patient_id
     LEFT JOIN users ru ON ru.user_id = v.recorded_by
  WHERE COALESCE(v.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | visits_view              | 10              | deworming_given                      | boolean                     |  SELECT v.visit_id,
    v.patient_id,
    p.full_name AS patient_name,
    v.visit_date,
    v.findings,
    v.service_rendered,
    ru.full_name AS recorded_by,
    ( SELECT COALESCE(json_agg(json_build_object('vaccine_id', im.vaccine_id, 'antigen_name', vm.antigen_name, 'dose_number', im.dose_number, 'administered_date', timezone('Asia/Manila'::text, im.administered_date::timestamp with time zone), 'outside', COALESCE(im.outside, false)) ORDER BY vm.antigen_name, im.dose_number), '[]'::json) AS "coalesce"
           FROM immunizations im
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE im.visit_id = v.visit_id AND COALESCE(im.is_deleted, false) = false) AS immunizations_given,
    (EXISTS ( SELECT 1
           FROM vitamina vt
          WHERE vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false)) AS vitamina_given,
    (EXISTS ( SELECT 1
           FROM deworming d
          WHERE d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false)) AS deworming_given,
    ( SELECT json_build_object('temperature', vs.temperature, 'respiration_rate', vs.respiration_rate, 'weight', vs.weight, 'height_length', vs.height_length, 'muac', vs.muac) AS json_build_object
           FROM vitalsigns vs
          WHERE vs.visit_id = v.visit_id AND COALESCE(vs.is_deleted, false) = false
          ORDER BY vs.created_at DESC NULLS LAST
         LIMIT 1) AS vital_signs
   FROM visits v
     JOIN patients p ON p.patient_id = v.patient_id
     LEFT JOIN users ru ON ru.user_id = v.recorded_by
  WHERE COALESCE(v.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | visits_view              | 11              | vital_signs                          | json                        |  SELECT v.visit_id,
    v.patient_id,
    p.full_name AS patient_name,
    v.visit_date,
    v.findings,
    v.service_rendered,
    ru.full_name AS recorded_by,
    ( SELECT COALESCE(json_agg(json_build_object('vaccine_id', im.vaccine_id, 'antigen_name', vm.antigen_name, 'dose_number', im.dose_number, 'administered_date', timezone('Asia/Manila'::text, im.administered_date::timestamp with time zone), 'outside', COALESCE(im.outside, false)) ORDER BY vm.antigen_name, im.dose_number), '[]'::json) AS "coalesce"
           FROM immunizations im
             JOIN vaccinemaster vm ON vm.vaccine_id = im.vaccine_id
          WHERE im.visit_id = v.visit_id AND COALESCE(im.is_deleted, false) = false) AS immunizations_given,
    (EXISTS ( SELECT 1
           FROM vitamina vt
          WHERE vt.visit_id = v.visit_id AND COALESCE(vt.is_deleted, false) = false)) AS vitamina_given,
    (EXISTS ( SELECT 1
           FROM deworming d
          WHERE d.visit_id = v.visit_id AND COALESCE(d.is_deleted, false) = false)) AS deworming_given,
    ( SELECT json_build_object('temperature', vs.temperature, 'respiration_rate', vs.respiration_rate, 'weight', vs.weight, 'height_length', vs.height_length, 'muac', vs.muac) AS json_build_object
           FROM vitalsigns vs
          WHERE vs.visit_id = v.visit_id AND COALESCE(vs.is_deleted, false) = false
          ORDER BY vs.created_at DESC NULLS LAST
         LIMIT 1) AS vital_signs
   FROM visits v
     JOIN patients p ON p.patient_id = v.patient_id
     LEFT JOIN users ru ON ru.user_id = v.recorded_by
  WHERE COALESCE(v.is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| public | worker_progress_view     | 1               | user_id                              | bigint                      |  SELECT user_id,
    role,
    firstname,
    surname,
    ( SELECT count(*) AS count
           FROM immunizations im
          WHERE im.administered_by = u.user_id AND COALESCE(im.is_deleted, false) = false) AS vaccines_administered,
    ( SELECT count(*) AS count
           FROM vitamina vt
          WHERE vt.administered_by = u.user_id AND COALESCE(vt.is_deleted, false) = false) AS vitamina_administered,
    ( SELECT count(*) AS count
           FROM deworming d
          WHERE d.administered_by = u.user_id AND COALESCE(d.is_deleted, false) = false) AS deworming_administered
   FROM users u
  WHERE COALESCE(is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| public | worker_progress_view     | 2               | role                                 | character varying           |  SELECT user_id,
    role,
    firstname,
    surname,
    ( SELECT count(*) AS count
           FROM immunizations im
          WHERE im.administered_by = u.user_id AND COALESCE(im.is_deleted, false) = false) AS vaccines_administered,
    ( SELECT count(*) AS count
           FROM vitamina vt
          WHERE vt.administered_by = u.user_id AND COALESCE(vt.is_deleted, false) = false) AS vitamina_administered,
    ( SELECT count(*) AS count
           FROM deworming d
          WHERE d.administered_by = u.user_id AND COALESCE(d.is_deleted, false) = false) AS deworming_administered
   FROM users u
  WHERE COALESCE(is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| public | worker_progress_view     | 3               | firstname                            | character varying           |  SELECT user_id,
    role,
    firstname,
    surname,
    ( SELECT count(*) AS count
           FROM immunizations im
          WHERE im.administered_by = u.user_id AND COALESCE(im.is_deleted, false) = false) AS vaccines_administered,
    ( SELECT count(*) AS count
           FROM vitamina vt
          WHERE vt.administered_by = u.user_id AND COALESCE(vt.is_deleted, false) = false) AS vitamina_administered,
    ( SELECT count(*) AS count
           FROM deworming d
          WHERE d.administered_by = u.user_id AND COALESCE(d.is_deleted, false) = false) AS deworming_administered
   FROM users u
  WHERE COALESCE(is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| public | worker_progress_view     | 4               | surname                              | character varying           |  SELECT user_id,
    role,
    firstname,
    surname,
    ( SELECT count(*) AS count
           FROM immunizations im
          WHERE im.administered_by = u.user_id AND COALESCE(im.is_deleted, false) = false) AS vaccines_administered,
    ( SELECT count(*) AS count
           FROM vitamina vt
          WHERE vt.administered_by = u.user_id AND COALESCE(vt.is_deleted, false) = false) AS vitamina_administered,
    ( SELECT count(*) AS count
           FROM deworming d
          WHERE d.administered_by = u.user_id AND COALESCE(d.is_deleted, false) = false) AS deworming_administered
   FROM users u
  WHERE COALESCE(is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| public | worker_progress_view     | 5               | vaccines_administered                | bigint                      |  SELECT user_id,
    role,
    firstname,
    surname,
    ( SELECT count(*) AS count
           FROM immunizations im
          WHERE im.administered_by = u.user_id AND COALESCE(im.is_deleted, false) = false) AS vaccines_administered,
    ( SELECT count(*) AS count
           FROM vitamina vt
          WHERE vt.administered_by = u.user_id AND COALESCE(vt.is_deleted, false) = false) AS vitamina_administered,
    ( SELECT count(*) AS count
           FROM deworming d
          WHERE d.administered_by = u.user_id AND COALESCE(d.is_deleted, false) = false) AS deworming_administered
   FROM users u
  WHERE COALESCE(is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| public | worker_progress_view     | 6               | vitamina_administered                | bigint                      |  SELECT user_id,
    role,
    firstname,
    surname,
    ( SELECT count(*) AS count
           FROM immunizations im
          WHERE im.administered_by = u.user_id AND COALESCE(im.is_deleted, false) = false) AS vaccines_administered,
    ( SELECT count(*) AS count
           FROM vitamina vt
          WHERE vt.administered_by = u.user_id AND COALESCE(vt.is_deleted, false) = false) AS vitamina_administered,
    ( SELECT count(*) AS count
           FROM deworming d
          WHERE d.administered_by = u.user_id AND COALESCE(d.is_deleted, false) = false) AS deworming_administered
   FROM users u
  WHERE COALESCE(is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| public | worker_progress_view     | 7               | deworming_administered               | bigint                      |  SELECT user_id,
    role,
    firstname,
    surname,
    ( SELECT count(*) AS count
           FROM immunizations im
          WHERE im.administered_by = u.user_id AND COALESCE(im.is_deleted, false) = false) AS vaccines_administered,
    ( SELECT count(*) AS count
           FROM vitamina vt
          WHERE vt.administered_by = u.user_id AND COALESCE(vt.is_deleted, false) = false) AS vitamina_administered,
    ( SELECT count(*) AS count
           FROM deworming d
          WHERE d.administered_by = u.user_id AND COALESCE(d.is_deleted, false) = false) AS deworming_administered
   FROM users u
  WHERE COALESCE(is_deleted, false) = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |